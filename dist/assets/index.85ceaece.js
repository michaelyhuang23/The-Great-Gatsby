import{S as t,P as e,W as n,A as i,F as r,a as o,b as a,T as s,R as l,V as u,G as c,c as f,M as d,d as p,e as h,f as m,g as v,h as g,i as x,j as y,E as b,k as w,C as _,l as C,m as T}from"./vendor.c39ff00a.js";const M=new t,B=new e(75,window.innerWidth/window.innerHeight,1,2e3);let A=0;let I=.9;const S=new n({canvas:document.querySelector("#bg"),powerPreference:"high-performance",antialias:!1,stencil:!1,depth:!1});S.setPixelRatio(window.devicePixelRatio),S.setSize(window.innerWidth,window.innerHeight),S.toneMapping=i;let E=new r(7695,1,1500);M.fog=E,S.render(M,B);let U=new u;const D=new a(new o(1e4,1e4),{textureWidth:512,textureHeight:512,waterNormals:(new s).load("images/waternormals.jpg",(function(t){t.wrapS=t.wrapT=l})),sunDirection:new u,sunColor:15658734,waterColor:7695,distortionScale:3.7,fog:void 0!==M.fog});D.rotation.x=-Math.PI/2,M.add(D);let F=(new s).load("images/tower.mtl");let R;(new c).load("images/tower.glb",(function(t){t.scene.traverse((function(t){t.isMesh&&(t.material.map=F)})),t.scene.position.set(0,-2,500),R=t.scene,M.add(R)}));const j=new f(2,24,24),L=new d({color:89624,emissive:89624,emissiveIntensity:3}),z=new p(j,L);z.position.set(0,30,500);const O=new h(89624);O.position.set(0,30,490),M.add(O);const k=new m;k.scale.setScalar(1e4),M.add(k);const P=k.material.uniforms;P.turbidity.value=.1,P.rayleigh.value=.005,P.mieCoefficient.value=5e-7,P.mieDirectionalG.value=.008;const N=new v(S);U.setFromSphericalCoords(1,1,190),k.material.uniforms.sunPosition.value.copy(U),D.material.uniforms.sunDirection.value.copy(U).normalize(),M.environment=N.fromScene(k).texture;const W=new g(16777215);W.intensity=1,M.add(W);let G=new x(B,z,{resolutionScale:1,density:.8,decay:.98,weight:.9,samples:100}),q=new y(M,B),V=new b(B,G);V.renderToScreen=!0;let Y=new w(S);Y.addPass(q),Y.addPass(V);let H=[];function X(t,e,n){const i=(new s).load("images/"+t),r=new o(50,50),a=new p(r,new C({map:i}));let l=30;return n&&(l*=-1),a.position.set(l,22,e),a.rotation.set(0,Math.PI,0),a.material.transparent=!0,M.add(a),a}(new s).load("images/snow.png",(function(t){let e=new _(4,4),n=new C({map:t,transparent:!0,opacity:.8,color:16777215});for(let i=0;i<100;i++){let t=new p(e,n);t.position.set(200*Math.random()-100,200*Math.random()+100,500*Math.random()),t.rotation.x=Math.PI+Math.random()*Math.PI/3,t.rotation.y=Math.random()*Math.PI/3,t.rotation.z=Math.random()*Math.PI*2,H.push(t),M.add(t)}})),M.add(z),Array(2e3).fill().forEach((function(){const t=new f(2,24,24),e=new d({color:16777215}),n=new p(t,e);let i=T.randFloatSpread(Math.PI),r=T.randFloatSpread(2*Math.PI),o=T.randFloatSpread(1e3)+1500,a=o*Math.cos(i),s=o*Math.sin(i),l=s*Math.sin(r),u=s*Math.cos(r);n.position.set(l,a,u),M.add(n)}));let Q=X("dump-ground.png",130,!0),K=X("myrtle.png",330,!1),Z=X("death-car.jpg",530,!0);function J(t){let e=Math.abs(t.position.z-B.position.z);t.material.opacity=e>100?0:e<50?1:1-(e-50)/50}B.position.set(0,20,0),B.lookAt(new u(0,30,200)),document.body.onscroll=function(){const t=document.body.getBoundingClientRect().top;B.position.z=.1*-t,A=.1*-t,z.position.z=A+500,O.position.z=A+500-10,R.position.z=A+500};let $=0;!function t(){requestAnimationFrame(t),J(Q),J(K),J(Z),$+=1/60*I,G.godRaysMaterial.uniforms.decay.value=Math.abs(Math.sin($))/2+.48,$>=2*Math.PI&&($=0,I=.5*Math.random()+.9),D.material.uniforms.time.value+=2/60,H.forEach((t=>{t.position.y-=1,t.position.y<=0&&t.position.set(200*Math.random()-100,200*Math.random()+100,A+500*Math.random())})),Y.render(.1)}(),function(){var t="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global||this,e=t._,n=Array.prototype,i=Object.prototype,r="undefined"!=typeof Symbol?Symbol.prototype:null,o=n.push,a=n.slice,s=i.toString,l=i.hasOwnProperty,u=Array.isArray,c=Object.keys,f=Object.create,d=function(){},p=function(t){return t instanceof p?t:this instanceof p?void(this._wrapped=t):new p(t)};"undefined"==typeof exports||exports.nodeType?t._=p:("undefined"!=typeof module&&!module.nodeType&&module.exports&&(exports=module.exports=p),exports._=p),p.VERSION="1.8.3";var h,m=function(t,e,n){if(void 0===e)return t;switch(null==n?3:n){case 1:return function(n){return t.call(e,n)};case 3:return function(n,i,r){return t.call(e,n,i,r)};case 4:return function(n,i,r,o){return t.call(e,n,i,r,o)}}return function(){return t.apply(e,arguments)}},v=function(t,e,n){return p.iteratee!==h?p.iteratee(t,e):null==t?p.identity:p.isFunction(t)?m(t,e,n):p.isObject(t)?p.matcher(t):p.property(t)};p.iteratee=h=function(t,e){return v(t,e,1/0)};var g=function(t,e){return e=null==e?t.length-1:+e,function(){for(var n=Math.max(arguments.length-e,0),i=Array(n),r=0;r<n;r++)i[r]=arguments[r+e];switch(e){case 0:return t.call(this,i);case 1:return t.call(this,arguments[0],i);case 2:return t.call(this,arguments[0],arguments[1],i)}var o=Array(e+1);for(r=0;r<e;r++)o[r]=arguments[r];return o[e]=i,t.apply(this,o)}},x=function(t){if(!p.isObject(t))return{};if(f)return f(t);d.prototype=t;var e=new d;return d.prototype=null,e},y=function(t){return function(e){return null==e?void 0:e[t]}},b=Math.pow(2,53)-1,w=y("length"),_=function(t){var e=w(t);return"number"==typeof e&&e>=0&&e<=b};p.each=p.forEach=function(t,e,n){var i,r;if(e=m(e,n),_(t))for(i=0,r=t.length;i<r;i++)e(t[i],i,t);else{var o=p.keys(t);for(i=0,r=o.length;i<r;i++)e(t[o[i]],o[i],t)}return t},p.map=p.collect=function(t,e,n){e=v(e,n);for(var i=!_(t)&&p.keys(t),r=(i||t).length,o=Array(r),a=0;a<r;a++){var s=i?i[a]:a;o[a]=e(t[s],s,t)}return o};var C=function(t){var e=function(e,n,i,r){var o=!_(e)&&p.keys(e),a=(o||e).length,s=t>0?0:a-1;for(r||(i=e[o?o[s]:s],s+=t);s>=0&&s<a;s+=t){var l=o?o[s]:s;i=n(i,e[l],l,e)}return i};return function(t,n,i,r){var o=arguments.length>=3;return e(t,m(n,r,4),i,o)}};p.reduce=p.foldl=p.inject=C(1),p.reduceRight=p.foldr=C(-1),p.find=p.detect=function(t,e,n){var i=(_(t)?p.findIndex:p.findKey)(t,e,n);if(void 0!==i&&-1!==i)return t[i]},p.filter=p.select=function(t,e,n){var i=[];return e=v(e,n),p.each(t,(function(t,n,r){e(t,n,r)&&i.push(t)})),i},p.reject=function(t,e,n){return p.filter(t,p.negate(v(e)),n)},p.every=p.all=function(t,e,n){e=v(e,n);for(var i=!_(t)&&p.keys(t),r=(i||t).length,o=0;o<r;o++){var a=i?i[o]:o;if(!e(t[a],a,t))return!1}return!0},p.some=p.any=function(t,e,n){e=v(e,n);for(var i=!_(t)&&p.keys(t),r=(i||t).length,o=0;o<r;o++){var a=i?i[o]:o;if(e(t[a],a,t))return!0}return!1},p.contains=p.includes=p.include=function(t,e,n,i){return _(t)||(t=p.values(t)),("number"!=typeof n||i)&&(n=0),p.indexOf(t,e,n)>=0},p.invoke=g((function(t,e,n){var i=p.isFunction(e);return p.map(t,(function(t){var r=i?e:t[e];return null==r?r:r.apply(t,n)}))})),p.pluck=function(t,e){return p.map(t,p.property(e))},p.where=function(t,e){return p.filter(t,p.matcher(e))},p.findWhere=function(t,e){return p.find(t,p.matcher(e))},p.max=function(t,e,n){var i,r,o=-1/0,a=-1/0;if(null==e||"number"==typeof e&&"object"!=typeof t[0]&&null!=t)for(var s=0,l=(t=_(t)?t:p.values(t)).length;s<l;s++)null!=(i=t[s])&&i>o&&(o=i);else e=v(e,n),p.each(t,(function(t,n,i){((r=e(t,n,i))>a||r===-1/0&&o===-1/0)&&(o=t,a=r)}));return o},p.min=function(t,e,n){var i,r,o=1/0,a=1/0;if(null==e||"number"==typeof e&&"object"!=typeof t[0]&&null!=t)for(var s=0,l=(t=_(t)?t:p.values(t)).length;s<l;s++)null!=(i=t[s])&&i<o&&(o=i);else e=v(e,n),p.each(t,(function(t,n,i){((r=e(t,n,i))<a||r===1/0&&o===1/0)&&(o=t,a=r)}));return o},p.shuffle=function(t){return p.sample(t,1/0)},p.sample=function(t,e,n){if(null==e||n)return _(t)||(t=p.values(t)),t[p.random(t.length-1)];var i=_(t)?p.clone(t):p.values(t),r=w(i);e=Math.max(Math.min(e,r),0);for(var o=r-1,a=0;a<e;a++){var s=p.random(a,o),l=i[a];i[a]=i[s],i[s]=l}return i.slice(0,e)},p.sortBy=function(t,e,n){var i=0;return e=v(e,n),p.pluck(p.map(t,(function(t,n,r){return{value:t,index:i++,criteria:e(t,n,r)}})).sort((function(t,e){var n=t.criteria,i=e.criteria;if(n!==i){if(n>i||void 0===n)return 1;if(n<i||void 0===i)return-1}return t.index-e.index})),"value")};var T=function(t,e){return function(n,i,r){var o=e?[[],[]]:{};return i=v(i,r),p.each(n,(function(e,r){var a=i(e,r,n);t(o,e,a)})),o}};p.groupBy=T((function(t,e,n){p.has(t,n)?t[n].push(e):t[n]=[e]})),p.indexBy=T((function(t,e,n){t[n]=e})),p.countBy=T((function(t,e,n){p.has(t,n)?t[n]++:t[n]=1}));var M=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;p.toArray=function(t){return t?p.isArray(t)?a.call(t):p.isString(t)?t.match(M):_(t)?p.map(t,p.identity):p.values(t):[]},p.size=function(t){return null==t?0:_(t)?t.length:p.keys(t).length},p.partition=T((function(t,e,n){t[n?0:1].push(e)}),!0),p.first=p.head=p.take=function(t,e,n){if(null!=t)return null==e||n?t[0]:p.initial(t,t.length-e)},p.initial=function(t,e,n){return a.call(t,0,Math.max(0,t.length-(null==e||n?1:e)))},p.last=function(t,e,n){if(null!=t)return null==e||n?t[t.length-1]:p.rest(t,Math.max(0,t.length-e))},p.rest=p.tail=p.drop=function(t,e,n){return a.call(t,null==e||n?1:e)},p.compact=function(t){return p.filter(t,Boolean)};var B=function(t,e,n,i){for(var r=(i=i||[]).length,o=0,a=w(t);o<a;o++){var s=t[o];if(_(s)&&(p.isArray(s)||p.isArguments(s)))if(e)for(var l=0,u=s.length;l<u;)i[r++]=s[l++];else B(s,e,n,i),r=i.length;else n||(i[r++]=s)}return i};p.flatten=function(t,e){return B(t,e,!1)},p.without=g((function(t,e){return p.difference(t,e)})),p.uniq=p.unique=function(t,e,n,i){p.isBoolean(e)||(i=n,n=e,e=!1),null!=n&&(n=v(n,i));for(var r=[],o=[],a=0,s=w(t);a<s;a++){var l=t[a],u=n?n(l,a,t):l;e?(a&&o===u||r.push(l),o=u):n?p.contains(o,u)||(o.push(u),r.push(l)):p.contains(r,l)||r.push(l)}return r},p.union=g((function(t){return p.uniq(B(t,!0,!0))})),p.intersection=function(t){for(var e=[],n=arguments.length,i=0,r=w(t);i<r;i++){var o=t[i];if(!p.contains(e,o)){var a;for(a=1;a<n&&p.contains(arguments[a],o);a++);a===n&&e.push(o)}}return e},p.difference=g((function(t,e){return e=B(e,!0,!0),p.filter(t,(function(t){return!p.contains(e,t)}))})),p.unzip=function(t){for(var e=t&&p.max(t,w).length||0,n=Array(e),i=0;i<e;i++)n[i]=p.pluck(t,i);return n},p.zip=g(p.unzip),p.object=function(t,e){for(var n={},i=0,r=w(t);i<r;i++)e?n[t[i]]=e[i]:n[t[i][0]]=t[i][1];return n};var A=function(t){return function(e,n,i){n=v(n,i);for(var r=w(e),o=t>0?0:r-1;o>=0&&o<r;o+=t)if(n(e[o],o,e))return o;return-1}};p.findIndex=A(1),p.findLastIndex=A(-1),p.sortedIndex=function(t,e,n,i){for(var r=(n=v(n,i,1))(e),o=0,a=w(t);o<a;){var s=Math.floor((o+a)/2);n(t[s])<r?o=s+1:a=s}return o};var I=function(t,e,n){return function(i,r,o){var s=0,l=w(i);if("number"==typeof o)t>0?s=o>=0?o:Math.max(o+l,s):l=o>=0?Math.min(o+1,l):o+l+1;else if(n&&o&&l)return i[o=n(i,r)]===r?o:-1;if(r!=r)return(o=e(a.call(i,s,l),p.isNaN))>=0?o+s:-1;for(o=t>0?s:l-1;o>=0&&o<l;o+=t)if(i[o]===r)return o;return-1}};p.indexOf=I(1,p.findIndex,p.sortedIndex),p.lastIndexOf=I(-1,p.findLastIndex),p.range=function(t,e,n){null==e&&(e=t||0,t=0),n||(n=e<t?-1:1);for(var i=Math.max(Math.ceil((e-t)/n),0),r=Array(i),o=0;o<i;o++,t+=n)r[o]=t;return r},p.chunk=function(t,e){if(null==e||e<1)return[];for(var n=[],i=0,r=t.length;i<r;)n.push(a.call(t,i,i+=e));return n};var S=function(t,e,n,i,r){if(!(i instanceof e))return t.apply(n,r);var o=x(t.prototype),a=t.apply(o,r);return p.isObject(a)?a:o};p.bind=g((function(t,e,n){if(!p.isFunction(t))throw new TypeError("Bind must be called on a function");var i=g((function(r){return S(t,i,e,this,n.concat(r))}));return i})),p.partial=g((function(t,e){var n=p.partial.placeholder,i=function(){for(var r=0,o=e.length,a=Array(o),s=0;s<o;s++)a[s]=e[s]===n?arguments[r++]:e[s];for(;r<arguments.length;)a.push(arguments[r++]);return S(t,i,this,this,a)};return i})),p.partial.placeholder=p,p.bindAll=g((function(t,e){var n=(e=B(e,!1,!1)).length;if(n<1)throw new Error("bindAll must be passed function names");for(;n--;){var i=e[n];t[i]=p.bind(t[i],t)}})),p.memoize=function(t,e){var n=function(i){var r=n.cache,o=""+(e?e.apply(this,arguments):i);return p.has(r,o)||(r[o]=t.apply(this,arguments)),r[o]};return n.cache={},n},p.delay=g((function(t,e,n){return setTimeout((function(){return t.apply(null,n)}),e)})),p.defer=p.partial(p.delay,p,1),p.throttle=function(t,e,n){var i,r,o,a,s=0;n||(n={});var l=function(){s=!1===n.leading?0:p.now(),i=null,a=t.apply(r,o),i||(r=o=null)},u=function(){var u=p.now();s||!1!==n.leading||(s=u);var c=e-(u-s);return r=this,o=arguments,c<=0||c>e?(i&&(clearTimeout(i),i=null),s=u,a=t.apply(r,o),i||(r=o=null)):i||!1===n.trailing||(i=setTimeout(l,c)),a};return u.cancel=function(){clearTimeout(i),s=0,i=r=o=null},u},p.debounce=function(t,e,n){var i,r,o=function(e,n){i=null,n&&(r=t.apply(e,n))},a=g((function(a){if(i&&clearTimeout(i),n){var s=!i;i=setTimeout(o,e),s&&(r=t.apply(this,a))}else i=p.delay(o,e,this,a);return r}));return a.cancel=function(){clearTimeout(i),i=null},a},p.wrap=function(t,e){return p.partial(e,t)},p.negate=function(t){return function(){return!t.apply(this,arguments)}},p.compose=function(){var t=arguments,e=t.length-1;return function(){for(var n=e,i=t[e].apply(this,arguments);n--;)i=t[n].call(this,i);return i}},p.after=function(t,e){return function(){if(--t<1)return e.apply(this,arguments)}},p.before=function(t,e){var n;return function(){return--t>0&&(n=e.apply(this,arguments)),t<=1&&(e=null),n}},p.once=p.partial(p.before,2),p.restArgs=g;var E=!{toString:null}.propertyIsEnumerable("toString"),U=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],D=function(t,e){var n=U.length,r=t.constructor,o=p.isFunction(r)&&r.prototype||i,a="constructor";for(p.has(t,a)&&!p.contains(e,a)&&e.push(a);n--;)(a=U[n])in t&&t[a]!==o[a]&&!p.contains(e,a)&&e.push(a)};p.keys=function(t){if(!p.isObject(t))return[];if(c)return c(t);var e=[];for(var n in t)p.has(t,n)&&e.push(n);return E&&D(t,e),e},p.allKeys=function(t){if(!p.isObject(t))return[];var e=[];for(var n in t)e.push(n);return E&&D(t,e),e},p.values=function(t){for(var e=p.keys(t),n=e.length,i=Array(n),r=0;r<n;r++)i[r]=t[e[r]];return i},p.mapObject=function(t,e,n){e=v(e,n);for(var i=p.keys(t),r=i.length,o={},a=0;a<r;a++){var s=i[a];o[s]=e(t[s],s,t)}return o},p.pairs=function(t){for(var e=p.keys(t),n=e.length,i=Array(n),r=0;r<n;r++)i[r]=[e[r],t[e[r]]];return i},p.invert=function(t){for(var e={},n=p.keys(t),i=0,r=n.length;i<r;i++)e[t[n[i]]]=n[i];return e},p.functions=p.methods=function(t){var e=[];for(var n in t)p.isFunction(t[n])&&e.push(n);return e.sort()};var F=function(t,e){return function(n){var i=arguments.length;if(e&&(n=Object(n)),i<2||null==n)return n;for(var r=1;r<i;r++)for(var o=arguments[r],a=t(o),s=a.length,l=0;l<s;l++){var u=a[l];e&&void 0!==n[u]||(n[u]=o[u])}return n}};p.extend=F(p.allKeys),p.extendOwn=p.assign=F(p.keys),p.findKey=function(t,e,n){e=v(e,n);for(var i,r=p.keys(t),o=0,a=r.length;o<a;o++)if(e(t[i=r[o]],i,t))return i};var R,j,L=function(t,e,n){return e in n};p.pick=g((function(t,e){var n={},i=e[0];if(null==t)return n;p.isFunction(i)?(e.length>1&&(i=m(i,e[1])),e=p.allKeys(t)):(i=L,e=B(e,!1,!1),t=Object(t));for(var r=0,o=e.length;r<o;r++){var a=e[r],s=t[a];i(s,a,t)&&(n[a]=s)}return n})),p.omit=g((function(t,e){var n,i=e[0];return p.isFunction(i)?(i=p.negate(i),e.length>1&&(n=e[1])):(e=p.map(B(e,!1,!1),String),i=function(t,n){return!p.contains(e,n)}),p.pick(t,i,n)})),p.defaults=F(p.allKeys,!0),p.create=function(t,e){var n=x(t);return e&&p.extendOwn(n,e),n},p.clone=function(t){return p.isObject(t)?p.isArray(t)?t.slice():p.extend({},t):t},p.tap=function(t,e){return e(t),t},p.isMatch=function(t,e){var n=p.keys(e),i=n.length;if(null==t)return!i;for(var r=Object(t),o=0;o<i;o++){var a=n[o];if(e[a]!==r[a]||!(a in r))return!1}return!0},R=function(t,e,n,i){if(t===e)return 0!==t||1/t==1/e;if(null==t||null==e)return t===e;if(t!=t)return e!=e;var r=typeof t;return("function"===r||"object"===r||"object"==typeof e)&&j(t,e,n,i)},j=function(t,e,n,i){t instanceof p&&(t=t._wrapped),e instanceof p&&(e=e._wrapped);var o=s.call(t);if(o!==s.call(e))return!1;switch(o){case"[object RegExp]":case"[object String]":return""+t==""+e;case"[object Number]":return+t!=+t?+e!=+e:0==+t?1/+t==1/e:+t==+e;case"[object Date]":case"[object Boolean]":return+t==+e;case"[object Symbol]":return r.valueOf.call(t)===r.valueOf.call(e)}var a="[object Array]"===o;if(!a){if("object"!=typeof t||"object"!=typeof e)return!1;var l=t.constructor,u=e.constructor;if(l!==u&&!(p.isFunction(l)&&l instanceof l&&p.isFunction(u)&&u instanceof u)&&"constructor"in t&&"constructor"in e)return!1}i=i||[];for(var c=(n=n||[]).length;c--;)if(n[c]===t)return i[c]===e;if(n.push(t),i.push(e),a){if((c=t.length)!==e.length)return!1;for(;c--;)if(!R(t[c],e[c],n,i))return!1}else{var f,d=p.keys(t);if(c=d.length,p.keys(e).length!==c)return!1;for(;c--;)if(f=d[c],!p.has(e,f)||!R(t[f],e[f],n,i))return!1}return n.pop(),i.pop(),!0},p.isEqual=function(t,e){return R(t,e)},p.isEmpty=function(t){return null==t||(_(t)&&(p.isArray(t)||p.isString(t)||p.isArguments(t))?0===t.length:0===p.keys(t).length)},p.isElement=function(t){return!(!t||1!==t.nodeType)},p.isArray=u||function(t){return"[object Array]"===s.call(t)},p.isObject=function(t){var e=typeof t;return"function"===e||"object"===e&&!!t},p.each(["Arguments","Function","String","Number","Date","RegExp","Error","Symbol","Map","WeakMap","Set","WeakSet"],(function(t){p["is"+t]=function(e){return s.call(e)==="[object "+t+"]"}})),p.isArguments(arguments)||(p.isArguments=function(t){return p.has(t,"callee")});var z=t.document&&t.document.childNodes;"function"!=typeof/./&&"object"!=typeof Int8Array&&"function"!=typeof z&&(p.isFunction=function(t){return"function"==typeof t||!1}),p.isFinite=function(t){return!p.isSymbol(t)&&isFinite(t)&&!isNaN(parseFloat(t))},p.isNaN=function(t){return isNaN(t)&&p.isNumber(t)},p.isBoolean=function(t){return!0===t||!1===t||"[object Boolean]"===s.call(t)},p.isNull=function(t){return null===t},p.isUndefined=function(t){return void 0===t},p.has=function(t,e){return null!=t&&l.call(t,e)},p.noConflict=function(){return t._=e,this},p.identity=function(t){return t},p.constant=function(t){return function(){return t}},p.noop=function(){},p.property=y,p.propertyOf=function(t){return null==t?function(){}:function(e){return t[e]}},p.matcher=p.matches=function(t){return t=p.extendOwn({},t),function(e){return p.isMatch(e,t)}},p.times=function(t,e,n){var i=Array(Math.max(0,t));e=m(e,n,1);for(var r=0;r<t;r++)i[r]=e(r);return i},p.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))},p.now=Date.now||function(){return(new Date).getTime()};var O={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},k=p.invert(O),P=function(t){var e=function(e){return t[e]},n="(?:"+p.keys(t).join("|")+")",i=RegExp(n),r=RegExp(n,"g");return function(t){return t=null==t?"":""+t,i.test(t)?t.replace(r,e):t}};p.escape=P(O),p.unescape=P(k),p.result=function(t,e,n){var i=null==t?void 0:t[e];return void 0===i&&(i=n),p.isFunction(i)?i.call(t):i};var N=0;p.uniqueId=function(t){var e=++N+"";return t?t+e:e},p.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var W=/(.)^/,G={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},q=/\\|'|\r|\n|\u2028|\u2029/g,V=function(t){return"\\"+G[t]};p.template=function(t,e,n){!e&&n&&(e=n),e=p.defaults({},e,p.templateSettings);var i,r=RegExp([(e.escape||W).source,(e.interpolate||W).source,(e.evaluate||W).source].join("|")+"|$","g"),o=0,a="__p+='";t.replace(r,(function(e,n,i,r,s){return a+=t.slice(o,s).replace(q,V),o=s+e.length,n?a+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":i?a+="'+\n((__t=("+i+"))==null?'':__t)+\n'":r&&(a+="';\n"+r+"\n__p+='"),e})),a+="';\n",e.variable||(a="with(obj||{}){\n"+a+"}\n"),a="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+a+"return __p;\n";try{i=new Function(e.variable||"obj","_",a)}catch(u){throw u.source=a,u}var s=function(t){return i.call(this,t,p)},l=e.variable||"obj";return s.source="function("+l+"){\n"+a+"}",s},p.chain=function(t){var e=p(t);return e._chain=!0,e};var Y=function(t,e){return t._chain?p(e).chain():e};p.mixin=function(t){return p.each(p.functions(t),(function(e){var n=p[e]=t[e];p.prototype[e]=function(){var t=[this._wrapped];return o.apply(t,arguments),Y(this,n.apply(p,t))}})),p},p.mixin(p),p.each(["pop","push","reverse","shift","sort","splice","unshift"],(function(t){var e=n[t];p.prototype[t]=function(){var n=this._wrapped;return e.apply(n,arguments),"shift"!==t&&"splice"!==t||0!==n.length||delete n[0],Y(this,n)}})),p.each(["concat","join","slice"],(function(t){var e=n[t];p.prototype[t]=function(){return Y(this,e.apply(this._wrapped,arguments))}})),p.prototype.value=function(){return this._wrapped},p.prototype.valueOf=p.prototype.toJSON=p.prototype.value,p.prototype.toString=function(){return""+this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],(function(){return p}))}();var tt,et,nt,it={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{var t=document.createElement("canvas");return!(!window.WebGLRenderingContext||!t.getContext("webgl")&&!t.getContext("experimental-webgl"))}catch(e){return!1}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var t=document.createElement("div");return t.id="webgl-error-message",t.style.fontFamily="monospace",t.style.fontSize="13px",t.style.fontWeight="normal",t.style.textAlign="center",t.style.background="#fff",t.style.color="#000",t.style.padding="1.5em",t.style.width="400px",t.style.margin="5em auto 0",this.webgl||(t.innerHTML=window.WebGLRenderingContext?['Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n"):['Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n")),t},addGetWebGLMessage:function(t){var e,n,i;e=void 0!==(t=t||{}).parent?t.parent:document.body,n=void 0!==t.id?t.id:"oldie",(i=it.getWebGLErrorMessage()).id=n,e.appendChild(i)}};"object"==typeof module&&(module.exports=it),function(t,e){function n(){return t.navigator&&/Trident/.test(t.navigator.userAgent)}if(n()||!t.msSetImmediate&&!t.setImmediate){var i,r=t.document,o=Array.prototype.slice,a=Object.prototype.toString,s={};s.polifill={},s.nextId=1,s.tasks={},s.lock=!1,s.run=function(e){if(s.lock)t.setTimeout(s.wrap(s.run,e),0);else{var n=s.tasks[e];if(n){s.lock=!0;try{n()}finally{s.clear(e),s.lock=!1}}}},s.wrap=function(t){var n=o.call(arguments,1);return function(){t.apply(e,n)}},s.create=function(t){return s.tasks[s.nextId]=s.wrap.apply(e,t),s.nextId++},s.clear=function(t){delete s.tasks[t]},s.polifill.messageChannel=function(){var e=new t.MessageChannel;return e.port1.onmessage=function(t){s.run(Number(t.data))},function(){var t=s.create(arguments);return e.port2.postMessage(t),t}},s.polifill.nextTick=function(){return function(){var e=s.create(arguments);return t.process.nextTick(s.wrap(s.run,e)),e}},s.polifill.postMessage=function(){var e="setImmediate$"+Math.random()+"$",n=function(n){n.source===t&&"string"==typeof n.data&&0===n.data.indexOf(e)&&s.run(Number(n.data.slice(e.length)))};return t.addEventListener?t.addEventListener("message",n,!1):t.attachEvent("onmessage",n),function(){var n=s.create(arguments);return t.postMessage(e+n,"*"),n}},s.polifill.readyStateChange=function(){var t=r.documentElement;return function(){var e=s.create(arguments),n=r.createElement("script");return n.onreadystatechange=function(){s.run(e),n.onreadystatechange=null,t.removeChild(n),n=null},t.appendChild(n),e}},s.polifill.setTimeout=function(){return function(){var e=s.create(arguments);return t.setTimeout(s.wrap(s.run,e),0),e}},i=n()?"setTimeout":"[object process]"===a.call(t.process)?"nextTick":function(){if(t.postMessage&&!t.importScripts){var e=!0,n=t.onmessage;return t.onmessage=function(){e=!1},t.postMessage("","*"),t.onmessage=n,e}}()?"postMessage":t.MessageChannel?"messageChannel":r&&"onreadystatechange"in r.createElement("script")?"readyStateChange":"setTimeout";var l=Object.getPrototypeOf&&Object.getPrototypeOf(t);(l=l&&l.setTimeout?l:t).setImmediate=s.polifill[i](),l.setImmediate.usePolifill=i,l.msSetImmediate=l.setImmediate,l.clearImmediate=s.clear,l.msClearImmediate=s.clear}else t.setImmediate||(t.setImmediate=t.msSetImmediate,t.clearImmediate=t.msClearImmediate)}(function(){return this||(0,eval)("this")}()),function(){function t(){}function e(t,e){for(var n=t.length;n--;)if(t[n].listener===e)return n;return-1}function n(t){return function(){return this[t].apply(this,arguments)}}var i=t.prototype,r=this,o=r.EventEmitter;i.getListeners=function(t){var e,n,i=this._getEvents();if(t instanceof RegExp)for(n in e={},i)i.hasOwnProperty(n)&&t.test(n)&&(e[n]=i[n]);else e=i[t]||(i[t]=[]);return e},i.flattenListeners=function(t){var e,n=[];for(e=0;e<t.length;e+=1)n.push(t[e].listener);return n},i.getListenersAsObject=function(t){var e,n=this.getListeners(t);return n instanceof Array&&((e={})[t]=n),e||n},i.addListener=function(t,n){var i,r=this.getListenersAsObject(t),o="object"==typeof n;for(i in r)r.hasOwnProperty(i)&&-1===e(r[i],n)&&r[i].push(o?n:{listener:n,once:!1});return this},i.on=n("addListener"),i.addOnceListener=function(t,e){return this.addListener(t,{listener:e,once:!0})},i.once=n("addOnceListener"),i.defineEvent=function(t){return this.getListeners(t),this},i.defineEvents=function(t){for(var e=0;e<t.length;e+=1)this.defineEvent(t[e]);return this},i.removeListener=function(t,n){var i,r,o=this.getListenersAsObject(t);for(r in o)o.hasOwnProperty(r)&&-1!==(i=e(o[r],n))&&o[r].splice(i,1);return this},i.off=n("removeListener"),i.addListeners=function(t,e){return this.manipulateListeners(!1,t,e)},i.removeListeners=function(t,e){return this.manipulateListeners(!0,t,e)},i.manipulateListeners=function(t,e,n){var i,r,o=t?this.removeListener:this.addListener,a=t?this.removeListeners:this.addListeners;if("object"!=typeof e||e instanceof RegExp)for(i=n.length;i--;)o.call(this,e,n[i]);else for(i in e)e.hasOwnProperty(i)&&(r=e[i])&&("function"==typeof r?o.call(this,i,r):a.call(this,i,r));return this},i.removeEvent=function(t){var e,n=typeof t,i=this._getEvents();if("string"===n)delete i[t];else if(t instanceof RegExp)for(e in i)i.hasOwnProperty(e)&&t.test(e)&&delete i[e];else delete this._events;return this},i.removeAllListeners=n("removeEvent"),i.emitEvent=function(t,e){var n,i,r,o,a=this.getListenersAsObject(t);for(o in a)if(a.hasOwnProperty(o))for(r=(n=a[o].slice(0)).length;r--;)!0===(i=n[r]).once&&this.removeListener(t,i.listener),i.listener.apply(this,e||[])===this._getOnceReturnValue()&&this.removeListener(t,i.listener);return this},i.trigger=n("emitEvent"),i.emit=function(t){var e=Array.prototype.slice.call(arguments,1);return this.emitEvent(t,e)},i.setOnceReturnValue=function(t){return this._onceReturnValue=t,this},i._getOnceReturnValue=function(){return!this.hasOwnProperty("_onceReturnValue")||this._onceReturnValue},i._getEvents=function(){return this._events||(this._events={})},t.noConflict=function(){return r.EventEmitter=o,t},"function"==typeof define&&define.amd?define((function(){return t})):"object"==typeof module&&module.exports?module.exports=t:r.EventEmitter=t}.call(void 0),GrowingPacker=function(){},GrowingPacker.prototype={fit:function(t){var e,n,i,r=t.length,o=r>0?t[0].w:0,a=r>0?t[0].h:0;for(this.root={x:0,y:0,w:o,h:a},e=0;e<r;e++)i=t[e],(n=this.findNode(this.root,i.w,i.h))?i.fit=this.splitNode(n,i.w,i.h):i.fit=this.growNode(i.w,i.h)},findNode:function(t,e,n){return t.used?this.findNode(t.right,e,n)||this.findNode(t.down,e,n):e<=t.w&&n<=t.h?t:null},splitNode:function(t,e,n){return t.used=!0,t.down={x:t.x,y:t.y+n,w:t.w,h:t.h-n},t.right={x:t.x+e,y:t.y,w:t.w-e,h:n},t},growNode:function(t,e){var n=t<=this.root.w,i=e<=this.root.h,r=i&&this.root.h>=this.root.w+t,o=n&&this.root.w>=this.root.h+e;return r?this.growRight(t,e):o?this.growDown(t,e):i?this.growRight(t,e):n?this.growDown(t,e):null},growRight:function(t,e){this.root={used:!0,x:0,y:0,w:this.root.w+t,h:this.root.h,down:this.root,right:{x:this.root.w,y:0,w:t,h:this.root.h}};var n=this.findNode(this.root,t,e);return n?this.splitNode(n,t,e):null},growDown:function(t,e){this.root={used:!0,x:0,y:0,w:this.root.w,h:this.root.h+e,down:{x:0,y:this.root.h,w:this.root.w,h:e},right:this.root};var n=this.findNode(this.root,t,e);return n?this.splitNode(n,t,e):null}},function(){for(var t=this,e=0,n=["ms","moz","webkit","o"],i=0;i<n.length&&!t.requestAnimationFrame;++i)t.requestAnimationFrame=t[n[i]+"RequestAnimationFrame"],t.cancelAnimationFrame=t[n[i]+"CancelAnimationFrame"]||t[n[i]+"CancelRequestAnimationFrame"];t.requestAnimationFrame||(t.requestAnimationFrame=function(n,i){var r=(new Date).getTime(),o=Math.max(0,16-(r-e)),a=t.setTimeout((function(){n(r+o)}),o);return e=r+o,a}),t.cancelAnimationFrame||(t.cancelAnimationFrame=function(t){clearTimeout(t)}),"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=t.requestAnimationFrame),exports.requestAnimationFrame=t.requestAnimationFrame):t.requestAnimationFrame=t.requestAnimationFrame,"function"==typeof define&&define.amd&&define("requestAnimationFrame",[],(function(){return t.requestAnimationFrame}))}(),function(t,e,n,i,r){var o=this.Blotter=function(t,e){i.webgl||o.Messaging.throwError("Blotter",!1,"device does not support webgl"),this._texts=[],this._textEventBindings={},this._scopes={},this._scopeEventBindings={},this._renderer=new o.Renderer,this._startTime=0,this._lastDrawTime=0,this.init.apply(this,arguments)};o.prototype=function(){function t(){var t=Date.now();this._material.uniforms.uTimeDelta.value=(t-(this._lastDrawTime||t))/1e3,this._material.uniforms.uGlobalTime.value=(t-this._startTime)/1e3,this._lastDrawTime=t}function n(){t.call(this),e.each(this._scopes,e.bind((function(t){t.playing&&t.render(),this.trigger("render")}),this))}function i(t){if(this.mappingMaterial){var e=this._material.uniforms[t].value;this.mappingMaterial.uniformInterface[t].value=e}}function r(t,e){if(this.mappingMaterial){var n=this._scopes[t].material.uniforms[e].value;this.mappingMaterial.textUniformInterface[t][e].value=n}}function a(){var t,n,i;t=e.bind((function(){return e.bind((function(t){o.MappingBuilder.build(this._texts,e.bind((function(e){this._mapping=e,this._mapping.ratio=this.ratio,t()}),this))}),this)}),this),n=e.bind((function(){return e.bind((function(t){o.MappingMaterialBuilder.build(this._mapping,this._material,e.bind((function(e){this.mappingMaterial=e,t()}),this))}),this)}),this),i=[t(),n()],e(i).reduceRight(e.wrap,e.bind((function(){this._renderer.stop(),e.each(this._scopes,e.bind((function(t,e){t.mappingMaterial=this.mappingMaterial,t.needsUpdate=!0}),this)),this._renderer.material=this.mappingMaterial.shaderMaterial,this._renderer.width=this._mapping.width,this._renderer.height=this._mapping.height,this.autostart&&this.start(),this.trigger(this.lastUpdated?"update":"ready"),this.lastUpdated=Date.now()}),this))()}return{constructor:o,get needsUpdate(){},set needsUpdate(t){!0===t&&a.call(this)},get material(){return this._material},set material(t){this.setMaterial(t)},get texts(){return this._texts},set texts(t){this.removeTexts(this._texts),this.addTexts(t)},get imageData(){return this._renderer.imageData},init:function(t,i){i=i||{},e.defaults(this,i,{ratio:o.CanvasUtils.pixelRatio,autobuild:!0,autostart:!0,autoplay:!0}),this.setMaterial(t),this.addTexts(i.texts),this._renderer.on("render",e.bind(n,this)),this.autobuild&&(this.needsUpdate=!0),this.autostart&&this.start()},start:function(){this.autostart=!0,this._startTime=Date.now(),this._renderer.start()},stop:function(){this.autostart=!1,this._renderer.stop()},teardown:function(){this._renderer.teardown()},setMaterial:function(t){o.Messaging.ensureInstanceOf(t,o.Material,"Blotter.Material","Blotter","setMaterial"),this._material=t,this._materialEventBinding&&this._materialEventBinding.unsetEventCallbacks(),this._materialEventBinding=new o.ModelEventBinding(t,{update:e.bind((function(){a.call(this)}),this),updateUniform:e.bind((function(t){i.call(this,t)}),this)}),t.on("update",this._materialEventBinding.eventCallbacks.update),t.on("update:uniform",this._materialEventBinding.eventCallbacks.updateUniform)},addText:function(t){this.addTexts(t)},addTexts:function(t){var n=o.TextUtils.filterTexts(t),i=e.difference(n,this._texts);e.each(i,e.bind((function(t){this._texts.push(t),this._textEventBindings[t.id]=new o.ModelEventBinding(t,{update:e.bind((function(){a.call(this)}),this)}),t.on("update",this._textEventBindings[t.id].eventCallbacks.update),this._scopes[t.id]=new o.RenderScope(t,this),this._scopeEventBindings[t.id]=new o.ModelEventBinding(this._scopes[t.id],{updateUniform:e.bind((function(e){r.call(this,t.id,e)}),this)}),this._scopes[t.id].on("update:uniform",this._scopeEventBindings[t.id].eventCallbacks.updateUniform)}),this))},removeText:function(t){this.removeTexts(t)},removeTexts:function(t){var n=o.TextUtils.filterTexts(t),i=e.intersection(this._texts,n);e.each(i,e.bind((function(t){this._texts=e.without(this._texts,t),this._textEventBindings[t.id].unsetEventCallbacks(),this._scopeEventBindings[t.id].unsetEventCallbacks(),delete this._textEventBindings[t.id],delete this._scopeEventBindings[t.id],delete this._scopes[t.id]}),this))},forText:function(t){return o.Messaging.ensureInstanceOf(t,o.Text,"Blotter.Text","Blotter","forText"),this._scopes[t.id]?this._scopes[t.id]:void o.Messaging.logError("Blotter","forText","Blotter.Text object not found in blotter")},boundsForText:function(t){return o.Messaging.ensureInstanceOf(t,o.Text,"Blotter.Text","Blotter","boundsForText"),this._scopes[t.id]?this._mapping?this.mappingMaterial.boundsForText(t):void 0:void o.Messaging.logError("Blotter","boundsForText","Blotter.Text object not found in blotter")}}}(),e.extend(o.prototype,r.prototype),o.Version="v0.1.0",o.webglRenderer=o.webglRenderer||new n.WebGLRenderer({antialias:!0,alpha:!0,premultipliedAlpha:!1}),o.Assets=o.Assets||{},o.Assets.Shaders=o.Assets.Shaders||{}}((void 0).Blotter,(void 0)._,(void 0).THREE,(void 0).Detector,(void 0).EventEmitter),(void 0).Blotter.Math={generateUUID:function(){for(var t=[],e=0;e<256;e++)t[e]=(e<16?"0":"")+e.toString(16).toUpperCase();return function(){var e=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return t[255&e]+t[e>>8&255]+t[e>>16&255]+t[e>>24&255]+"-"+t[255&n]+t[n>>8&255]+"-"+t[n>>16&15|64]+t[n>>24&255]+"-"+t[63&i|128]+t[i>>8&255]+"-"+t[i>>16&255]+t[i>>24&255]+t[255&r]+t[r>>8&255]+t[r>>16&255]+t[r>>24&255]}}()},(void 0).Blotter.Messaging=function(){function t(t,e,n){return t+(e?"#"+e:"")+": "+n}return{ensureInstanceOf:function(t,e,n,i,r){t instanceof e||this.logError(i,r,"argument must be instanceof "+n)},logError:function(e,n,i){var r=t(e,n,i);console.error(r)},logWarning:function(e,n,i){var r=t(e,n,i);console.warn(r)},throwError:function(e,n,i){throw t(e,n,i)}}}(),tt=(void 0).Blotter,et=(void 0)._,tt._extendWithGettersSetters=function(t){return et.each(Array.prototype.slice.call(arguments,1),(function(e){if(e)for(var n in e)t[n]&&Object.getOwnPropertyDescriptor(t,n)&&Object.getOwnPropertyDescriptor(t,n).set?Object.getOwnPropertyDescriptor(t,n).set(e[n]):t[n]=e[n]})),t},(void 0).Blotter.VendorPrefixes=["ms","moz","webkit","o"],function(t,e){t.ModelEventBinding=function(t,e){this.model=t,this.eventCallbacks=e||{}},t.ModelEventBinding.prototype={constructor:t.ModelEventBinding,unsetEventCallbacks:function(){e.each(this.eventCallbacks,e.bind((function(t,e){this.model.off(e,t)}),this))}}}((void 0).Blotter,(void 0)._),function(t){t.CanvasUtils={canvas:function(t,e,n){n=n||{};var i=document.createElement("canvas");return i.className=n.class,i.innerHTML=n.html,i.width=t,i.height=e,i},hiDpiCanvas:function(t,e,n,i){n=n||this.pixelRatio,i=i||{};var r=document.createElement("canvas");return r.className=i.class,r.innerHTML=i.html,this.updateCanvasSize(r,t,e,n),r},updateCanvasSize:function(t,e,n,i){i=i||1,t.width=e*i,t.height=n*i,t.style.width=e+"px",t.style.height=n+"px",t.getContext("2d").setTransform(i,0,0,i,0,0)},pixelRatio:function(){for(var e=document.createElement("canvas").getContext("2d"),n=window.devicePixelRatio||1,i=e.backingStorePixelRatio,r=0;r<t.VendorPrefixes.length&&!i;++r)i=e[t.VendorPrefixes[r]+"BackingStorePixelRatio"];return n/(i=i||1)}(),mousePosition:function(t,e){var n=t.getBoundingClientRect();return{x:e.clientX-n.left,y:e.clientY-n.top}},normalizedMousePosition:function(t,e){var n=t.getBoundingClientRect(),i=this.mousePosition(t,e);return{x:i.x/n.width,y:i.y/n.height}}}}((void 0).Blotter),function(t,e){t.PropertyDefaults={family:"sans-serif",size:12,leading:1.5,fill:"#000",style:"normal",weight:400,padding:0,paddingTop:0,paddingRight:0,paddingBottom:0,paddingLeft:0},t.TextUtils={Properties:e.keys(t.PropertyDefaults),ensurePropertyValues:function(n){return e.defaults(n||{},t.PropertyDefaults)},filterTexts:function(n){return n=n instanceof t.Text?[n]:e.toArray(n),e.filter(n,e.bind((function(e){var n=e instanceof t.Text;return n||t.Messaging.logWarning("Blotter.TextUtils","filterTexts","object must be instance of Blotter.Text"),n}),this))},stringifiedPadding:function(t){var e=t||this.ensurePropertyValues();return(t.paddingTop||e.padding)+"px "+(e.paddingRight||e.padding)+"px "+(e.paddingBottom||e.padding)+"px "+(e.paddingLeft||e.padding)+"px"},sizeForText:function(t,e){var n,i=document.createElement("span");return e=this.ensurePropertyValues(e),i.innerHTML=t,i.style.display="inline-block",i.style.fontFamily=e.family,i.style.fontSize=e.size+"px",i.style.fontWeight=e.weight,i.style.fontStyle=e.style,i.style.lineHeight=e.leading,i.style.maxWidth="none",i.style.padding=this.stringifiedPadding(e),i.style.position="absolute",i.style.width="auto",i.style.visibility="hidden",document.body.appendChild(i),n={w:i.offsetWidth,h:i.offsetHeight},document.body.removeChild(i),n}}}((void 0).Blotter,(void 0)._),function(t,e){t.UniformUtils={UniformTypes:["1f","2f","3f","4f"],defaultUniforms:{uResolution:{type:"2f",value:[0,0]},uGlobalTime:{type:"1f",value:0},uTimeDelta:{type:"1f",value:0},uBlendColor:{type:"4f",value:[1,1,1,1]},uPixelRatio:{type:"1f",value:t.CanvasUtils.pixelRatio}},validValueForUniformType:function(t,n){var i=!1,r=function(t){return!isNaN(t)};switch(t){case"1f":i=!isNaN(n)&&[n].every(r);break;case"2f":i=e.isArray(n)&&2==n.length&&n.every(r);break;case"3f":i=e.isArray(n)&&3==n.length&&n.every(r);break;case"4f":i=e.isArray(n)&&4==n.length&&n.every(r)}return i},glslDataTypeForUniformType:function(t){var e;switch(t){case"1f":e="float";break;case"2f":e="vec2";break;case"3f":e="vec3";break;case"4f":e="vec4"}return e},fullSwizzleStringForUniformType:function(t){var e;switch(t){case"1f":e="x";break;case"2f":e="xy";break;case"3f":e="xyz";break;case"4f":e="xyzw"}return e},extractValidUniforms:function(n){return n=n||{},e.reduce(n,(function(n,i,r){return-1==t.UniformUtils.UniformTypes.indexOf(i.type)?(t.Messaging.logError("Blotter.UniformUtils","extractValidUniforms","uniforms must be one of type: "+t.UniformUtils.UniformTypes.join(", ")),n):t.UniformUtils.validValueForUniformType(i.type,i.value)?(n[r]=e.pick(i,"type","value"),n):(t.Messaging.logError("Blotter.UniformUtils","extractValidUniforms","uniform value for "+r+" is incorrect for type: "+i.type),n)}),{})},ensureHasRequiredDefaultUniforms:function(e,n,i){t.UniformUtils.hasRequiredDefaultUniforms(e)||this.logError(n,i,"uniforms object is missing required default uniforms defined in Blotter.UniformUtils.defaultUniforms")},hasRequiredDefaultUniforms:function(n){return!e.difference(e.allKeys(t.UniformUtils.defaultUniforms),e.allKeys(n)).length}}}((void 0).Blotter,(void 0)._),function(t,e,n,i){t.Text=function(e,n){this.id=t.Math.generateUUID(),this.value=e,this.properties=n},t.Text.prototype={constructor:t.Text,get needsUpdate(){},set needsUpdate(t){!0===t&&this.trigger("update")},get properties(){return this._properties},set properties(e){this._properties=t.TextUtils.ensurePropertyValues(e)}},t._extendWithGettersSetters(t.Text.prototype,i.prototype)}((void 0).Blotter,(void 0)._,(void 0).THREE,(void 0).EventEmitter),function(t,e){t.Assets.Shaders.Blending=["//","// Author : Bradley Griffith","// License : Distributed under the MIT License.","//","","// Returns the resulting blend color by blending a top color over a base color","highp vec4 normalBlend(highp vec4 topColor, highp vec4 baseColor) {","  highp vec4 blend = vec4(0.0);","  // HACK","  // Cant divide by 0 (see the 'else' alpha) and after a lot of attempts","  // this simply seems like the only solution Im going to be able to come up with to get alpha back.","  if (baseColor.a == 1.0) {","    baseColor.a = 0.9999999;","  };","  if (topColor.a >= 1.0) {","    blend.a = topColor.a;","    blend.r = topColor.r;","    blend.g = topColor.g;","    blend.b = topColor.b;","  } else if (topColor.a == 0.0) {","    blend.a = baseColor.a;","    blend.r = baseColor.r;","    blend.g = baseColor.g;","    blend.b = baseColor.b;","  } else {","    blend.a = 1.0 - (1.0 - topColor.a) * (1.0 - baseColor.a); // alpha","    blend.r = (topColor.r * topColor.a / blend.a) + (baseColor.r * baseColor.a * (1.0 - topColor.a) / blend.a);","    blend.g = (topColor.g * topColor.a / blend.a) + (baseColor.g * baseColor.a * (1.0 - topColor.a) / blend.a);","    blend.b = (topColor.b * topColor.a / blend.a) + (baseColor.b * baseColor.a * (1.0 - topColor.a) / blend.a);","  }","  return blend;","}","// Returns a vec4 representing the original top color that would have been needed to blend","//  against a passed in base color in order to result in the passed in blend color.","highp vec4 normalUnblend(highp vec4 blendColor, highp vec4 baseColor) {","  highp vec4 unblend = vec4(0.0);","  // HACKY","  // Cant divide by 0 (see alpha) and after a lot of attempts","  // this simply seems like the only solution Im going to be able to come up with to get alpha back.","  if (baseColor.a == 1.0) {","    baseColor.a = 0.9999999;","  }","  unblend.a = 1.0 - ((1.0 - blendColor.a) / (1.0 - baseColor.a));","  // Round to two decimal places","  unblend.a = (sign(100.0 * unblend.a) * floor(abs(100.0 * unblend.a) + 0.5)) / 100.0;","  if (unblend.a >= 1.0) {","    unblend.r = blendColor.r;","    unblend.g = blendColor.g;","    unblend.b = blendColor.b;","  } else if (unblend.a == 0.0) {","    unblend.r = baseColor.r;","    unblend.g = baseColor.g;","    unblend.b = baseColor.b;","  } else {","    unblend.r = (blendColor.r - (baseColor.r * baseColor.a * (1.0 - unblend.a) / blendColor.a)) / (unblend.a / blendColor.a);","    unblend.g = (blendColor.g - (baseColor.g * baseColor.a * (1.0 - unblend.a) / blendColor.a)) / (unblend.a / blendColor.a);","    unblend.b = (blendColor.b - (baseColor.b * baseColor.a * (1.0 - unblend.a) / blendColor.a)) / (unblend.a / blendColor.a);","  }","  return unblend;","}"].join("\n")}((void 0).Blotter,(void 0)._),function(t,e){t.Assets.Shaders.Inf=["//","// Author : Bradley Griffith","// License : Distributed under the MIT License.","//","bool isinf(float val) {","    return (val != 0.0 && val * 2.0 == val) ? true : false;","}"].join("\n")}((void 0).Blotter,(void 0)._),function(t,e){t.Assets.Shaders.LineMath=[t.Assets.Shaders.Inf,"","//","// Author : Bradley Griffith","// License : Distributed under the MIT License.","//","","// Returns the slope of a line given the degrees of the angle on which that line is rotated;","float slopeForDegrees(float deg) {","    // Ensure degrees stay withing 0.0 - 360.0","    deg = mod(deg, 360.0);","    float radians = deg * (PI / 180.0);","    return tan(radians);","}","// Given x, a slope, and another point, find y for x.","float yForXOnSlope(float x, float slope, vec2 p2) {","    return -1.0 * ((slope * (p2.x - x)) - p2.y);","}","// Given y, a slope, and another point, find x for y.","float xForYOnSlope(float y, float slope, vec2 p2) {","    return ((y - p2.y) + (slope * p2.x)) / slope;","}","// Returns slope adjusted for screen ratio.","float normalizedSlope(float slope, vec2 resolution) {","    vec2 p = vec2(1.0) / resolution;","    return ((slope * 100.0) / p.x) / (100.0 / p.x);","}","// Returns offsets (+/-) for any coordinate at distance given slope.","//   Note: This function does not normalize distance.","//   Note: This function does not adjust slope for screen ratio.","vec2 offsetsForCoordAtDistanceOnSlope(float d, float slope) {","    return vec2(","        (d * cos(atan(slope))),","        (d * sin(atan(slope)))","    );","}","// Returns a boolean designating whether or not an infinite line intersects with an infinite line, and sets an `out` variable for the intersection point if it is found.","//   Note: This function does not adjust slope for screen ratio.","bool lineLineIntersection (out vec2 intersect, in vec2 p1, in float m1, in vec2 p2, in float m2) {","    // See: http://gamedev.stackexchange.com/questions/44720/line-intersection-from-parametric-equation","    //      http://stackoverflow.com/questions/41687083/formula-to-determine-if-an-infinite-line-and-a-line-segment-intersect/41687904#41687904","    bool isIntersecting = false;","    float dx = 1.0;","    float dy = m1;","    float dxx = 1.0;","    float dyy = m2;","    float denominator = ((dxx * dy) - (dyy * dx));","    if (denominator == 0.0) {","        // Lines are parallel","        return isIntersecting;","    }","    if (isinf(dy)) {","        float y = yForXOnSlope(p1.x, m2, p2);","        isIntersecting = true;","        intersect = vec2(p1.x, y);","        return isIntersecting;","    }","    if (isinf(dyy)) {","        float y = yForXOnSlope(p2.x, m1, p1);","        isIntersecting = true;","        intersect = vec2(p2.x, y);","        return isIntersecting;","    }","    float u = ((dx * (p2.y - p1.y)) + (dy * (p1.x - p2.x))) / denominator;","    isIntersecting = true;","    intersect = p2 + (u * vec2(dxx, dyy));","    return isIntersecting;","}","// Returns a boolean designating whether or not an infinite line intersects with a line segment, and sets an `out` variable for the intersection point if it is found.","//   Note: This function does not adjust slope for screen ratio.","bool lineLineSegmentIntersection (out vec2 intersect, in vec2 point, in float m, in vec2 pA, in vec2 pB) {","    // See: http://gamedev.stackexchange.com/questions/44720/line-intersection-from-parametric-equation","    //      http://stackoverflow.com/questions/41687083/formula-to-determine-if-an-infinite-line-and-a-line-segment-intersect/41687904#41687904","    bool isIntersecting = false;","    float dx = 1.0;","    float dy = m;","    float dxx = pB.x - pA.x;","    float dyy = pB.y - pA.y;","    float denominator = ((dxx * dy) - (dyy * dx));","    if (denominator == 0.0 || (isinf(dyy / dxx) && isinf(dy))) {","        // Lines are parallel","        return isIntersecting;","    }","    if (isinf(dy)) {","        float m2 = dyy / dxx;","        float y = yForXOnSlope(point.x, m2, pB);","        isIntersecting = true;","        intersect = vec2(point.x, y);","        return isIntersecting;","    }","    float u = ((dx * (pA.y - point.y)) + (dy * (point.x - pA.x))) / denominator;","    if (u >= 0.0 && u <= 1.0) {","        // Intersection occured on line segment","        isIntersecting = true;","        intersect = pA + (u * vec2(dxx, dyy));","    }","    return isIntersecting;","}","// Dev Note: Terrible code. Needs refactor. Just trying to find ","//   which two edges of the rect the intersections occur at.","void intersectsOnRectForLine(out vec2 iA, out vec2 iB, in vec2 rMinXY, in vec2 rMaxXY, in vec2 point, in float slope) {","    bool firstIntersectFound = false;","    vec2 intersectLeft = vec2(0.0);","    vec2 intersectTop = vec2(0.0);","    vec2 intersectRight = vec2(0.0);","    vec2 intersectBottom = vec2(0.0);","    bool intersectsLeft = lineLineSegmentIntersection(intersectLeft, point, slope, rMinXY, vec2(rMinXY.x, rMaxXY.y));","    bool intersectsTop = lineLineSegmentIntersection(intersectTop, point, slope, vec2(rMinXY.x, rMaxXY.y), rMaxXY);","    bool intersectsRight = lineLineSegmentIntersection(intersectRight, point, slope, rMaxXY, vec2(rMaxXY.x, rMinXY.y));","    bool intersectsBottom = lineLineSegmentIntersection(intersectBottom, point, slope, rMinXY, vec2(rMaxXY.x, rMinXY.y));","    if (intersectsLeft) {","        if (firstIntersectFound) {","            iB = intersectLeft;","        }","        else {","            iA = intersectLeft;","            firstIntersectFound = true;","        }","    }","    if (intersectsTop) {","        if (firstIntersectFound) {","            iB = intersectTop;","        }","        else {","            iA = intersectTop;","            firstIntersectFound = true;","        }","    }","    if (intersectsRight) {","        if (firstIntersectFound) {","            iB = intersectRight;","        }","        else {","            iA = intersectRight;","            firstIntersectFound = true;","        }","    }","    if (intersectsBottom) {","        if (firstIntersectFound) {","            iB = intersectBottom;","        }","        else {","            iA = intersectBottom;","        }","    }","}"].join("\n")}((void 0).Blotter,(void 0)._),function(t,e){t.Assets.Shaders.BlinnPhongSpecular=["//","// Author : Reza Ali","// License : Distributed under the MIT License.","//","","float blinnPhongSpecular( vec3 lightDirection, vec3 viewDirection, vec3 surfaceNormal, float shininess ) {","","  //Calculate Blinn-Phong power","  vec3 H = normalize(viewDirection + lightDirection);","  return pow(max(0.0, dot(surfaceNormal, H)), shininess);","}"].join("\n")}((void 0).Blotter,(void 0)._),function(t,e){t.Assets.Shaders.Easing=["//","// Author : Reza Ali","// License : Distributed under the MIT License.","//","","float linear( float t, float b, float c, float d )","{","    return t * ( c / d ) + b;","}","","float linear( float t )","{","    return t;","}","","float inQuad( float t, float b, float c, float d )","{","    return c * ( t /= d ) * t + b;","}","","float inQuad( float t )","{","    return t * t;","}","","float outQuad( float t, float b, float c, float d )","{","    return -c * ( t /= d ) * ( t - 2.0 ) + b;","}","","float outQuad( float t )","{","    return - ( t -= 1.0 ) * t + 1.0;","}","","float inOutQuad( float t, float b, float c, float d )","{","    if( ( t /= d / 2.0 ) < 1.0 ) {","      return c / 2.0 * t * t + b;","    }","    return - c / 2.0 * ( ( --t ) * ( t - 2.0 ) - 1.0 ) + b;","}","","float inOutQuad( float t )","{","    if( ( t /= 0.5 ) < 1.0 ) return 0.5 * t * t;","    return -0.5 * ( ( --t ) * ( t-2 ) - 1 );","}","","float inCubic( float t, float b, float c, float d )","{","    return c * ( t /= d ) * t * t + b;","}","","float inCubic( float t )","{","    return t * t * t;","}","","float outCubic( float t, float b, float c, float d )","{","    return c * ( ( t = t/d - 1.0 ) * t * t + 1.0 ) + b;","}","","float outCubic( float t )","{","    return ( ( --t ) * t * t + 1.0 );","}","","float inOutCubic( float t, float b, float c, float d )","{","    if( ( t /= d / 2.0 ) < 1.0 ) return  c / 2.0 * t * t * t + b;","    return c / 2.0 * ( ( t -= 2.0 ) * t * t + 2.0 ) + b;","}","","float inOutCubic( float t )","{","    if( ( t /= 0.5 ) < 1.0 ) return 0.5 * t * t * t;","    return 0.5 * ( ( t -= 2.0 ) * t * t + 2.0 );","}","","float inQuart( float t, float b, float c, float d )","{","    return c * ( t /= d ) * t * t * t + b;","}","","float inQuart( float t )","{","    return t * t * t * t;","}","","float outQuart( float t, float b, float c, float d )","{","    return -c * ( ( t = t/d - 1.0 ) * t * t * t - 1.0 ) + b;","}","","float outQuart( float t )","{","    return - ( ( --t ) * t * t * t - 1.0 );","}","","float inOutQuart( float t, float b, float c, float d )","{","    if ( ( t /= d / 2.0 ) < 1.0 ) return c / 2.0 * t * t * t * t + b;","    return -c / 2.0 * ( ( t -= 2.0 ) * t * t * t - 2.0 ) + b;","}","","float inOutQuart( float t )","{","    if ( (t /= 0.5 ) < 1.0 ) return 0.5 * t * t * t * t;","    return -0.5 * ( ( t -= 2.0 ) * t * t * t - 2.0 );","}","","float inQuint( float t, float b, float c, float d )","{","    return c * ( t /= d ) * t * t * t * t + b;","}","","float inQuint( float t )","{","    return t * t * t * t * t;","}","","float outQuint( float t, float b, float c, float d )","{","    return c * ( ( t = t/d - 1.0) * t * t * t * t + 1.0 ) + b;","}","","float outQuint( float t )","{","    return ( ( --t ) * t * t * t * t + 1.0 );","}","","float inOutQuint( float t, float b, float c, float d )","{","    if( ( t /= d /2.0 ) < 1.0 ) return  c / 2.0 * t * t * t * t * t + b;","    return c / 2.0 * ( ( t -= 2.0 ) * t * t * t * t + 2.0) + b;","}","","float inOutQuint( float t )","{","    if ( ( t /= 0.5 ) < 1.0 ) return 0.5 * t * t * t * t * t;","    return 0.5 * ( ( t -= 2 ) * t * t * t * t + 2.0 );","}","","float inSine( float t, float b, float c, float d )","{","    return -c * cos( t / d * ( 1.5707963268 ) ) + c + b;","}","","float inSine( float t )","{","    return -1.0 * cos( t * ( 1.5707963268 ) ) + 1.0;","}","","float outSine( float t, float b, float c, float d )","{","    return c * sin( t / d * ( 1.5707963268 ) ) + b;","}","","float outSine( float t )","{","    return sin( t * ( 1.5707963268 ) );","}","","float inOutSine( float t, float b, float c, float d )","{","    return - c / 2.0 * ( cos( 3.1415926536 * t / d ) - 1.0 ) + b;","}","","float inOutSine( float t )","{","    return -0.5 * ( cos( 3.1415926536 * t ) - 1.0 );","}","","float inExpo( float t, float b, float c, float d )","{","    return ( t == 0.0 ) ? b : c * pow( 2.0, 10.0 * ( t / d - 1.0 ) ) + b;","}","","float inExpo( float t )","{","    return ( t == 0 ) ? 0.0 : pow( 2.0, 10.0 * ( t - 1.0 ) );","}","","float outExpo( float t, float b, float c, float d )","{","    return ( t == d ) ? b + c : c * ( - pow( 2.0, -10.0 * t / d ) + 1.0 ) + b;","}","","float outExpo( float t )","{","    return ( t == 1.0 ) ? 1.0 : ( - pow( 2.0, -10.0 * t ) + 1.0 );","}","","float inOutExpo( float t, float b, float c, float d )","{","    if( t == 0 ) return b;","    if( t == d ) return b + c;","    if(( t /= d / 2.0 ) < 1.0 ) return c / 2.0 * pow( 2.0, 10.0 * ( t - 1.0 ) ) + b;","    return c / 2.0 * ( - pow( 2.0, -10.0 * --t ) + 2.0 ) + b;","}","","float inOutExpo( float t )","{","    if( t == 0.0 ) return 0.0;","    if( t == 1.0 ) return 1.0;","    if( ( t /= 0.5 ) < 1.0 ) return 0.5 * pow( 2.0, 10.0 * ( t - 1.0 ) );","    return 0.5 * ( - pow( 2.0, -10.0 * --t ) + 2.0 );","}","","float inCirc( float t, float b, float c, float d )","{","    return -c * ( sqrt( 1.0 - (t/=d)*t) - 1) + b;","}","","float inCirc( float t )","{","    return - ( sqrt( 1.0 - t*t) - 1);","}","","float outCirc( float t, float b, float c, float d )","{","    return c * sqrt( 1.0 - (t=t/d-1)*t) + b;","}","","float outCirc( float t )","{","    return sqrt( 1.0 - (--t)*t);","}","","float inOutCirc( float t, float b, float c, float d )","{","    if ( ( t /= d / 2.0 ) < 1 ) return - c / 2.0 * ( sqrt( 1.0 - t * t ) - 1.0 ) + b;","    return c / 2.0 * ( sqrt( 1.0 - ( t -= 2.0 ) * t ) + 1.0 ) + b;","}","","float inOutCirc( float t )","{","    if( ( t /= 0.5 ) < 1.0 ) return -0.5 * ( sqrt( 1.0 - t * t ) - 1.0 );","    return 0.5 * ( sqrt( 1.0 - ( t -= 2.0 ) * t ) + 1.0 );","}","","float inElastic( float t, float b, float c, float d )","{","    float s = 1.70158; float p = 0.0; float a = c;","    if( t == 0 ) return b;  if( ( t /= d ) == 1 ) return b + c;","    p = d * 0.3;","    if( a < abs( c ) ) { a = c; float s = p / 4.0; }","    else s = 0.1591549431 * p / ( 6.2831853072 ) * asin( c / a );","    return -( a * pow( 2.0, 10.0 * ( t -= 1.0 ) ) * sin( ( t * d - s ) * ( 6.2831853072 ) / p ) )  + b;","}","","float inElastic( float t )","{","    float s = 1.70158; float p = 0.0; float a = 1.0;","    if( t == 0.0 ) return 0.0;","    if( t == 1.0 ) return 1.0;","    p = 0.3;","    s = p / ( 6.2831853072 ) * asin( 1.0 / a );","    return -( a * pow( 2.0, 10.0 * ( t -= 1.0 ) ) * sin( ( t - s ) * ( 6.2831853072 ) / p ) );","}","","float outElastic( float t, float b, float c, float d )","{","    float s = 1.70158; float p = 0.0; float a = c;","    if( t == 0.0 ) return b;","    if( (t /= d ) == 1.0 ) return b + c;","    p = d * 0.3;","    if( a < abs( c ) ) { a = c; s = p / 4.0; }","    else { s = p / ( 6.2831853072 ) * asin( c / a ); }","    return a * pow( 2.0, -10.0 * t ) * sin( ( t * d - s ) * ( 6.2831853072 ) / p ) + c + b;","}","","float outElastic( float t )","{","    float s = 1.70158; float p = 0.0 ; float a = 1.0;","    if( t == 0.0 ) return 0.0;  if( t == 1.0 ) return 1.0;","    p = 0.3;","    s = p / ( 6.2831853072 ) * asin( 1.0 / a );","    return a * pow( 2.0, -10.0 * t ) * sin( ( t - s ) * ( 6.2831853072 ) / p ) + 1.0;","}","","float inOutElastic( float t, float b, float c, float d )","{","    float s = 1.70158; float p = 0.0; float a = c;","    if( t == 0.0 ) return b;","    if( ( t /= d / 2.0 ) == 2.0 ) return b + c;","    p = d * ( 0.3 * 1.5 );","    if( a < abs( c ) ) { a = c; s = p / 4.0; }","    else { s = p / ( 6.2831853072 ) * asin( c / a ); }","    if( t < 1.0 ) return -0.5 * ( a * pow( 2.0, 10.0 * ( t -= 1.0 ) ) * sin( ( t * d - s ) * ( 6.2831853072 ) / p ) ) + b;","    return a * pow( 2.0, -10.0 * ( t -= 1.0 ) ) * sin( ( t * d - s ) * ( 6.2831853072 ) / p ) * 0.5 + c + b;","}","","float inOutElastic( float t )","{","    float s = 1.70158; float p = 0; float a = 1.0;","    if( t == 0 ) return 0.0;","    if( ( t /= 0.5 ) == 2.0 ) return 1.0;","    p = ( 0.3 * 1.5 );","    s = p / ( 6.2831853072 ) * asin( 1.0 / a );","    if( t < 1.0 ) return -0.5 * ( a * pow( 2.0, 10.0 * ( t -= 1.0 ) ) * sin( ( t - s ) * ( 6.2831853072 ) / p ) );","    return a * pow( 2.0, -10.0 * ( t -= 1.0 ) ) * sin( ( t - s ) * ( 6.2831853072 ) / p ) * 0.5 + 1.0;","}","","float inBack( float t, float b, float c, float d )","{","    float s = 1.70158;","    return c * ( t /= d ) * t * ( ( s + 1.0 ) * t - s ) + b;","}","","float inBack( float t )","{","    float s = 1.70158;","    return t * t * ( ( s + 1.0 ) * t - s);","}","","float outBack( float t,  float b,  float c,  float d )","{","    float s = 1.70158;","    return c * ( ( t = t / d - 1.0 ) * t * ( ( s + 1.0 ) * t + s ) + 1.0 ) + b;","}","","float outBack( float t )","{","    float s = 1.70158;","    return ( ( --t ) * t * ( ( s + 1.0 ) * t + s ) + 1.0);","}","","float inOutBack( float t, float b, float c, float d )","{","    float s = 1.70158;","    if( ( t /= d / 2.0 ) < 1.0 ) return c / 2.0 * ( t * t * ( ( ( s *= 1.525 ) + 1.0 ) * t - s ) ) + b;","    return c / 2.0 * ( ( t -= 2.0 ) * t * ( ( ( s *= ( 1.525 ) ) + 1.0 ) * t + s ) + 2.0 ) + b;","}","","float inOutBack( float t )","{","    float s = 1.70158;","    if( ( t /= 0.5 ) < 1.0 ) return 0.5 * ( t * t * ( ( ( s *= 1.525 ) + 1.0 ) * t - s ) );","    return 0.5 * ( ( t -= 2 ) * t * ( ( ( s *= ( 1.525 ) ) + 1.0 ) * t + s ) + 2.0 );","}","","float outBounce( float t, float b, float c, float d )","{","    if( ( t /= d ) < ( 1.0 / 2.75 ) ) {","        return c * ( 7.5625 * t * t ) + b;","    } else if ( t < ( 2.0 / 2.75 ) ) {","        return c * ( 7.5625 * ( t -= ( 1.5 / 2.75 ) ) * t + 0.75 ) + b;","    } else if ( t < ( 2.5 / 2.75 ) ) {","        return c * ( 7.5625 * ( t -= ( 2.25 / 2.75 ) ) * t + 0.9375 ) + b;","    } else {","        return c * ( 7.5625 * ( t -= ( 2.625 / 2.75 ) ) * t + 0.984375 ) + b;","    }","}","","float outBounce( float t )","{","    if( t < ( 1.0 / 2.75 ) ) {","        return ( 7.5625 * t * t );","    } else if ( t < ( 2.0 / 2.75 ) ) {","        return ( 7.5625 * ( t-= ( 1.5 / 2.75 ) ) * t + .75 );","    } else if ( t < ( 2.5 / 2.75 ) ) {","        return ( 7.5625 * ( t -= ( 2.25 / 2.75 ) ) * t + 0.9375 );","    } else {","        return ( 7.5625 * ( t -= ( 2.625 / 2.75 ) ) * t + 0.984375 );","    }","}","","float inBounce( float t, float b, float c, float d )","{","    return c - outBounce( d - t, 0.0, c, d ) + b;","}","","float inBounce( float t )","{","    return 1.0 - outBounce( 1.0 - t);","}","","float inOutBounce( float t, float b, float c, float d )","{","    if ( t < d /2.0 ) return inBounce ( t * 2.0, 0.0, c, d ) * 0.5 + b;","    return outBounce ( t * 2.0 - d, 0, c, d ) * 0.5 + c * 0.5 + b;","}","","float inOutBounce( float t )","{","    if ( t < 0.5 ) return inBounce( t * 2.0 ) * 0.5;","    return outBounce( t * 2.0 - 1.0 ) * 0.5 + 0.5;","}"].join("\n")}((void 0).Blotter,(void 0)._),function(t,e){t.Assets.Shaders.Gamma=["//","// Author : Reza Ali","// License : Distributed under the MIT License.","//","","const vec3 cGammaCorrection = vec3( 0.4545454545 );","","vec3 gamma( in vec3 color )","{","  return pow( color, cGammaCorrection );","}","","vec4 gamma( in vec4 color )","{","  return vec4( gamma( color.rgb ), color.a );","}"].join("\n")}((void 0).Blotter,(void 0)._),function(t,e){t.Assets.Shaders.Map=["//","// Author : Reza Ali","// License : Distributed under the MIT License.","//","","float map( float value, float inMin, float inMax, float outMin, float outMax )","{","    return ( (value - inMin) / ( inMax - inMin ) * ( outMax - outMin ) ) + outMin;","}"].join("\n")}((void 0).Blotter,(void 0)._),function(t,e){t.Assets.Shaders.Noise=["//","// Author : Patricio Gonzalez Vivo and Jen Lowe","// License : Distributed under the MIT License.","// Source : https://github.com/patriciogonzalezvivo/thebookofshaders","//","float random (in float _x) {","    return fract(sin(_x)*1e4);","}","","float random (in vec2 co) {","    return fract(sin(dot(co.xy,vec2(12.9898,78.233)))*43758.5453);","}","","float noise (in float _x) {","    float i = floor(_x);","    float f = fract(_x);","    float u = f * f * (3.0 - 2.0 * f);","    return mix(random(i), random(i + 1.0), u);","}","","float noise (in vec2 _st) {","    vec2 i = floor(_st);","    vec2 f = fract(_st);","    // Four corners in 2D of a tile","    float a = random(i);","    float b = random(i + vec2(1.0, 0.0));","    float c = random(i + vec2(0.0, 1.0));","    float d = random(i + vec2(1.0, 1.0));","    vec2 u = f * f * (3.0 - 2.0 * f);","    return mix(a, b, u.x) + ","            (c - a)* u.y * (1.0 - u.x) + ","            (d - b) * u.x * u.y;","}"].join("\n")}((void 0).Blotter,(void 0)._),function(t,e){t.Assets.Shaders.Noise2D=["//","// Description : Array and textureless GLSL 2D simplex noise function.","//      Author : Ian McEwan, Ashima Arts.","//  Maintainer : ijm","//     Lastmod : 20110822 (ijm)","//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.","//               Distributed under the MIT License. See LICENSE file.","//               https://github.com/ashima/webgl-noise","//","","vec2 n2mod289(vec2 x) {","  return x - floor(x * (1.0 / 289.0)) * 289.0;","}","","vec3 n2mod289(vec3 x) {","  return x - floor(x * (1.0 / 289.0)) * 289.0;","}","","vec4 n2mod289(vec4 x) {","  return x - floor(x * (1.0 / 289.0)) * 289.0;","}","","vec3 permute(vec3 x) {","  return n2mod289(((x*34.0)+1.0)*x);","}","","float snoise(vec2 v)","  {","  const vec4 C = vec4(0.211324865405187,  // (3.0-sqrt(3.0))/6.0","                      0.366025403784439,  // 0.5*(sqrt(3.0)-1.0)","                     -0.577350269189626,  // -1.0 + 2.0 * C.x","                      0.024390243902439); // 1.0 / 41.0","// First corner","  vec2 i  = floor(v + dot(v, C.yy) );","  vec2 x0 = v -   i + dot(i, C.xx);","","// Other corners","  vec2 i1;","  //i1.x = step( x0.y, x0.x ); // x0.x > x0.y ? 1.0 : 0.0","  //i1.y = 1.0 - i1.x;","  i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);","  // x0 = x0 - 0.0 + 0.0 * C.xx ;","  // x1 = x0 - i1 + 1.0 * C.xx ;","  // x2 = x0 - 1.0 + 2.0 * C.xx ;","  vec4 x12 = x0.xyxy + C.xxzz;","  x12.xy -= i1;","","// Permutations","  i = n2mod289(i); // Avoid truncation effects in permutation","  vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))","   + i.x + vec3(0.0, i1.x, 1.0 ));","","  vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);","  m = m*m ;","  m = m*m ;","","// Gradients: 41 points uniformly over a line, mapped onto a diamond.","// The ring size 17*17 = 289 is close to a multiple of 41 (41*7 = 287)","","  vec3 x = 2.0 * fract(p * C.www) - 1.0;","  vec3 h = abs(x) - 0.5;","  vec3 ox = floor(x + 0.5);","  vec3 a0 = x - ox;","","// Normalise gradients implicitly by scaling m","// Approximation of: m *= inversesqrt( a0*a0 + h*h );","  m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );","","// Compute final noise value at P","  vec3 g;","  g.x  = a0.x  * x0.x  + h.x  * x0.y;","  g.yz = a0.yz * x12.xz + h.yz * x12.yw;","  return 130.0 * dot(m, g);","}"].join("\n")}((void 0).Blotter,(void 0)._),function(t,e){t.Assets.Shaders.Noise3D=["//","// Description : Array and textureless GLSL 2D/3D/4D simplex","//               noise functions.","//      Author : Ian McEwan, Ashima Arts.","//  Maintainer : ijm","//     Lastmod : 20110822 (ijm)","//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.","//               Distributed under the MIT License. See LICENSE file.","//               https://github.com/ashima/webgl-noise","//","","vec2 n3mod289(vec2 x) {","  return x - floor(x * (1.0 / 289.0)) * 289.0;","}","","vec3 n3mod289(vec3 x) {","  return x - floor(x * (1.0 / 289.0)) * 289.0;","}","","vec4 n3mod289(vec4 x) {","  return x - floor(x * (1.0 / 289.0)) * 289.0;","}","","vec4 permute(vec4 x) {","     return n3mod289(((x*34.0)+1.0)*x);","}","","vec4 taylorInvSqrt(vec4 r)","{","  return 1.79284291400159 - 0.85373472095314 * r;","}","","float snoise(vec3 v)","  {","  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;","  const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);","","// First corner","  vec3 i  = floor(v + dot(v, C.yyy) );","  vec3 x0 =   v - i + dot(i, C.xxx) ;","","// Other corners","  vec3 g = step(x0.yzx, x0.xyz);","  vec3 l = 1.0 - g;","  vec3 i1 = min( g.xyz, l.zxy );","  vec3 i2 = max( g.xyz, l.zxy );","","  //   x0 = x0 - 0.0 + 0.0 * C.xxx;","  //   x1 = x0 - i1  + 1.0 * C.xxx;","  //   x2 = x0 - i2  + 2.0 * C.xxx;","  //   x3 = x0 - 1.0 + 3.0 * C.xxx;","  vec3 x1 = x0 - i1 + C.xxx;","  vec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y","  vec3 x3 = x0 - D.yyy;      // -1.0+3.0*C.x = -0.5 = -D.y","","// Permutations","  i = n3mod289(i);","  vec4 p = permute( permute( permute(","             i.z + vec4(0.0, i1.z, i2.z, 1.0 ))","           + i.y + vec4(0.0, i1.y, i2.y, 1.0 ))","           + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));","","// Gradients: 7x7 points over a square, mapped onto an octahedron.","// The ring size 17*17 = 289 is close to a multiple of 49 (49*6 = 294)","  float n_ = 0.142857142857; // 1.0/7.0","  vec3  ns = n_ * D.wyz - D.xzx;","","  vec4 j = p - 49.0 * floor(p * ns.z * ns.z);  //  mod(p,7*7)","","  vec4 x_ = floor(j * ns.z);","  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)","","  vec4 x = x_ *ns.x + ns.yyyy;","  vec4 y = y_ *ns.x + ns.yyyy;","  vec4 h = 1.0 - abs(x) - abs(y);","","  vec4 b0 = vec4( x.xy, y.xy );","  vec4 b1 = vec4( x.zw, y.zw );","","  //vec4 s0 = vec4(lessThan(b0,0.0))*2.0 - 1.0;","  //vec4 s1 = vec4(lessThan(b1,0.0))*2.0 - 1.0;","  vec4 s0 = floor(b0)*2.0 + 1.0;","  vec4 s1 = floor(b1)*2.0 + 1.0;","  vec4 sh = -step(h, vec4(0.0));","","  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;","  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;","","  vec3 p0 = vec3(a0.xy,h.x);","  vec3 p1 = vec3(a0.zw,h.y);","  vec3 p2 = vec3(a1.xy,h.z);","  vec3 p3 = vec3(a1.zw,h.w);","","//Normalise gradients","  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));","  p0 *= norm.x;","  p1 *= norm.y;","  p2 *= norm.z;","  p3 *= norm.w;","","// Mix final noise value","  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);","  m = m * m;","  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),","                                dot(p2,x2), dot(p3,x3) ) );","  }"].join("\n")}((void 0).Blotter,(void 0)._),function(t,e){t.Assets.Shaders.Noise4D=["//","// Description : Array and textureless GLSL 2D/3D/4D simplex","//               noise functions.","//      Author : Ian McEwan, Ashima Arts.","//  Maintainer : ijm","//     Lastmod : 20110822 (ijm)","//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.","//               Distributed under the MIT License. See LICENSE file.","//               https://github.com/ashima/webgl-noise","//","","vec4 mod289(vec4 x) {","  return x - floor(x * (1.0 / 289.0)) * 289.0; }","","float mod289(float x) {","  return x - floor(x * (1.0 / 289.0)) * 289.0; }","","vec4 permute(vec4 x) {","     return mod289(((x*34.0)+1.0)*x);","}","","float permute(float x) {","     return mod289(((x*34.0)+1.0)*x);","}","","vec4 taylorInvSqrt(vec4 r)","{","  return 1.79284291400159 - 0.85373472095314 * r;","}","","float taylorInvSqrt(float r)","{","  return 1.79284291400159 - 0.85373472095314 * r;","}","","vec4 grad4(float j, vec4 ip)","  {","  const vec4 ones = vec4(1.0, 1.0, 1.0, -1.0);","  vec4 p,s;","","  p.xyz = floor( fract (vec3(j) * ip.xyz) * 7.0) * ip.z - 1.0;","  p.w = 1.5 - dot(abs(p.xyz), ones.xyz);","  s = vec4(lessThan(p, vec4(0.0)));","  p.xyz = p.xyz + (s.xyz*2.0 - 1.0) * s.www;","","  return p;","  }","","// (sqrt(5) - 1)/4 = F4, used once below","#define F4 0.309016994374947451","","float snoise(vec4 v)","  {","  const vec4  C = vec4( 0.138196601125011,  // (5 - sqrt(5))/20  G4","                        0.276393202250021,  // 2 * G4","                        0.414589803375032,  // 3 * G4","                       -0.447213595499958); // -1 + 4 * G4","","// First corner","  vec4 i  = floor(v + dot(v, vec4(F4)) );","  vec4 x0 = v -   i + dot(i, C.xxxx);","","// Other corners","","// Rank sorting originally contributed by Bill Licea-Kane, AMD (formerly ATI)","  vec4 i0;","  vec3 isX = step( x0.yzw, x0.xxx );","  vec3 isYZ = step( x0.zww, x0.yyz );","//  i0.x = dot( isX, vec3( 1.0 ) );","  i0.x = isX.x + isX.y + isX.z;","  i0.yzw = 1.0 - isX;","//  i0.y += dot( isYZ.xy, vec2( 1.0 ) );","  i0.y += isYZ.x + isYZ.y;","  i0.zw += 1.0 - isYZ.xy;","  i0.z += isYZ.z;","  i0.w += 1.0 - isYZ.z;","","  // i0 now contains the unique values 0,1,2,3 in each channel","  vec4 i3 = clamp( i0, 0.0, 1.0 );","  vec4 i2 = clamp( i0-1.0, 0.0, 1.0 );","  vec4 i1 = clamp( i0-2.0, 0.0, 1.0 );","","  //  x0 = x0 - 0.0 + 0.0 * C.xxxx","  //  x1 = x0 - i1  + 1.0 * C.xxxx","  //  x2 = x0 - i2  + 2.0 * C.xxxx","  //  x3 = x0 - i3  + 3.0 * C.xxxx","  //  x4 = x0 - 1.0 + 4.0 * C.xxxx","  vec4 x1 = x0 - i1 + C.xxxx;","  vec4 x2 = x0 - i2 + C.yyyy;","  vec4 x3 = x0 - i3 + C.zzzz;","  vec4 x4 = x0 + C.wwww;","","// Permutations","  i = mod289(i);","  float j0 = permute( permute( permute( permute(i.w) + i.z) + i.y) + i.x);","  vec4 j1 = permute( permute( permute( permute (","             i.w + vec4(i1.w, i2.w, i3.w, 1.0 ))","           + i.z + vec4(i1.z, i2.z, i3.z, 1.0 ))","           + i.y + vec4(i1.y, i2.y, i3.y, 1.0 ))","           + i.x + vec4(i1.x, i2.x, i3.x, 1.0 ));","","// Gradients: 7x7x6 points over a cube, mapped onto a 4-cross polytope","// 7*7*6 = 294, which is close to the ring size 17*17 = 289.","  vec4 ip = vec4(1.0/294.0, 1.0/49.0, 1.0/7.0, 0.0) ;","","  vec4 p0 = grad4(j0,   ip);","  vec4 p1 = grad4(j1.x, ip);","  vec4 p2 = grad4(j1.y, ip);","  vec4 p3 = grad4(j1.z, ip);","  vec4 p4 = grad4(j1.w, ip);","","// Normalise gradients","  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));","  p0 *= norm.x;","  p1 *= norm.y;","  p2 *= norm.z;","  p3 *= norm.w;","  p4 *= taylorInvSqrt(dot(p4,p4));","","// Mix contributions from the five corners","  vec3 m0 = max(0.6 - vec3(dot(x0,x0), dot(x1,x1), dot(x2,x2)), 0.0);","  vec2 m1 = max(0.6 - vec2(dot(x3,x3), dot(x4,x4)            ), 0.0);","  m0 = m0 * m0;","  m1 = m1 * m1;","  return 49.0 * ( dot(m0*m0, vec3( dot( p0, x0 ), dot( p1, x1 ), dot( p2, x2 )))","               + dot(m1*m1, vec2( dot( p3, x3 ), dot( p4, x4 ) ) ) ) ;","","  }"].join("\n")}((void 0).Blotter,(void 0)._),function(t,e){t.Assets.Shaders.PI=["//","// Author : Reza Ali","// License : Distributed under the MIT License.","//","","#define TWO_PI 6.2831853072","#define PI 3.14159265359","#define HALF_PI 1.57079632679"].join("\n")}((void 0).Blotter,(void 0)._),function(t,e){t.Assets.Shaders.Random=["//","// Author : Patricio Gonzalez Vivo and Jen Lowe","// License : Distributed under the MIT License.","// Source : https://github.com/patriciogonzalezvivo/thebookofshaders","//","","float random (in float _x) {","    return fract(sin(_x)*1e4);","}","","float random (in vec2 co) {","    return fract(sin(dot(co.xy,vec2(12.9898,78.233)))*43758.5453);","}"].join("\n")}((void 0).Blotter,(void 0)._),function(t,e){t.Mapping=function(t,e,n,i){this.texts=t,this._textBounds=e,this._width=n,this._height=i,this._ratio=1},t.Mapping.prototype=function(){function n(e,n){return n=n||t.TextUtils.ensurePropertyValues().leading,isNaN(n)?-1!==n.toString().indexOf("px")?n=parseInt(n):-1!==n.toString().indexOf("%")&&(n=parseInt(n)/100*e):n*=e,n}return{constructor:t.Mapping,get ratio(){return this._ratio},set ratio(t){this._ratio=t||1},get width(){return this._width*this._ratio},get height(){return this._height*this._ratio},boundsForText:function(e){t.Messaging.ensureInstanceOf(e,t.Text,"Blotter.Text","Blotter.Mapping","boundsForText");var n=this._textBounds[e.id];return n&&(n={w:n.w*this._ratio,h:n.h*this._ratio,x:n.x*this._ratio,y:n.y*this._ratio}),n},toCanvas:function(i){var r=t.CanvasUtils.hiDpiCanvas(this._width,this._height,this._ratio),o=r.getContext("2d",{alpha:!1}),a=new Image;o.textBaseline="middle";for(var s=0;s<this.texts.length;s++){var l=this.texts[s],u=this._textBounds[l.id],c=n.call(this,l.properties.size,l.properties.leading)/2;o.font=l.properties.style+" "+l.properties.weight+" "+l.properties.size+"px "+l.properties.family,o.save(),o.translate(u.x+l.properties.paddingLeft,this._height-(u.y+u.h)+l.properties.paddingTop),o.fillStyle=l.properties.fill,o.fillText(l.value,0,Math.round(c)),o.restore()}a.onload=e.bind((function(){o.save(),o.scale(1,-1),o.clearRect(0,-1*this._height,this._width,this._height),o.drawImage(a,0,-1*this._height,this._width,this._height),o.restore(),i(r)}),this),a.src=r.toDataURL("image/png")}}}()}((void 0).Blotter,(void 0)._),function(t,e,n){t.MappingMaterial=function(t,e,n,i){this.mapping=t,this.material=e,this.shaderMaterial=n,this._userUniformDataTextureObjects=i,this.init.apply(this,arguments)},t.MappingMaterial.prototype=function(){function i(i){var r={_type:i.userUniform.type,_value:i.userUniform.value,get value(){return this._value},set value(e){t.UniformUtils.validValueForUniformType(this._type,e)?(this._value=e,this.trigger("update")):t.Messaging.logError("Blotter.MappingMaterial",!1,"uniform value not valid for uniform type: "+this._type)}};return e.extend(r,n.prototype),r}return{constructor:t.MappingMaterial,get uniforms(){return this.material.uniforms},get mainImage(){return this.material.mainImage},get width(){return this.mapping.width},get height(){return this.mapping.height},get ratio(){return this.mapping.ratio},init:function(t,n,r,o){this.textUniformInterface=function(t,n){return e.reduce(t.texts,(function(t,r,o){return t[r.id]=e.reduce(n.userUniforms,(function(t,e,r){var a=e.position+o;return t[r]=i(e),t[r].on("update",(function(){(function(t,e,n,i){var r=i.type;"1f"==r?(n[4*e]=t,n[4*e+1]=0,n[4*e+2]=0,n[4*e+3]=0):"2f"==r?(n[4*e]=t[0],n[4*e+1]=t[1],n[4*e+2]=0,n[4*e+3]=0):"3f"==r?(n[4*e]=t[0],n[4*e+1]=t[1],n[4*e+2]=t[2],n[4*e+3]=0):"4f"==r?(n[4*e]=t[0],n[4*e+1]=t[1],n[4*e+2]=t[2],n[4*e+3]=t[3]):(n[4*e]=0,n[4*e+1]=0,n[4*e+2]=0,n[4*e+3]=0)})(t[r].value,a,n.data,e.userUniform),n.texture.needsUpdate=!0})),t[r].value=e.userUniform.value,t}),{}),t}),{})}(this.mapping,this._userUniformDataTextureObjects),this.uniformInterface=function(t,n,r){return e.reduce(n.userUniforms,(function(o,a,s){return o[s]=i(a),o[s].on("update",(function(){e.each(t.texts,(function(t){r[t.id][s].value=o[s].value})),n.texture.needsUpdate=!0})),o}),{})}(this.mapping,this._userUniformDataTextureObjects,this.textUniformInterface)},boundsForText:function(e){return t.Messaging.ensureInstanceOf(e,t.Text,"Blotter.Text","Blotter.MappingMaterial","boundsForText"),this.mapping.boundsForText(e)}}}()}((void 0).Blotter,(void 0)._,(void 0).EventEmitter),function(t,e,n){t.Material=function(){this.init.apply(this,arguments)},t.Material.prototype=function(){function i(){return["void mainImage( out vec4 mainImage, in vec2 fragCoord ) {","mainImage = textTexture(fragCoord / uResolution);","}"].join("\n")}function r(i){return e.reduce(i,e.bind((function(i,r,o){return i[o]=function(i){var r={_type:i.type,_value:i.value,get type(){return this._type},set type(t){this._type=t},get value(){return this._value},set value(e){t.UniformUtils.validValueForUniformType(this._type,e)?(this._value=e,this.trigger("update")):t.Messaging.logError("Blotter.Material",!1,"uniform value not valid for uniform type: "+this._type)}};return e.extend(r,n.prototype),r}(r),i[o].on("update",e.bind((function(){this.trigger("update:uniform",[o])}),this)),i}),this),{})}return{constructor:t.Material,get needsUpdate(){},set needsUpdate(t){!0===t&&this.trigger("update")},get mainImage(){return this._mainImage},set mainImage(t){this._mainImage=t||i()},get uniforms(){return this._uniforms},set uniforms(n){this._uniforms=r.call(this,t.UniformUtils.extractValidUniforms(e.extend(n,t.UniformUtils.defaultUniforms)))},init:function(){this.mainImage=i(),this.uniforms={}}}}(),t._extendWithGettersSetters(t.Material.prototype,n.prototype)}((void 0).Blotter,(void 0)._,(void 0).EventEmitter),function(t,e){t.ShaderMaterial=function(e,n){t.Material.apply(this,arguments)},t.ShaderMaterial.prototype=Object.create(t.Material.prototype),t._extendWithGettersSetters(t.ShaderMaterial.prototype,{constructor:t.ShaderMaterial,init:function(t,n){e.defaults(this,n),this.mainImage=t}})}((void 0).Blotter,(void 0)._),function(t,e,n){t.RenderScope=function(e,n){this.text=e,this.blotter=n,this.material={mainImage:this.blotter.material.mainImage},this._mappingMaterial=n.mappingMaterial,this.playing=this.blotter.autoplay,this.timeDelta=0,this.lastDrawTime=!1,this.frameCount=0,this.domElement=t.CanvasUtils.hiDpiCanvas(0,0,this.blotter.ratio,{class:"b-canvas",html:e.value}),this.context=this.domElement.getContext("2d")},t.RenderScope.prototype=function(){function i(){function e(e){n.domElement.addEventListener(e,(function(i){var r=t.CanvasUtils.normalizedMousePosition(n.domElement,i);n.emit(e,r)}),!1)}for(var n=this,i=["mousedown","mouseup","mousemove","mouseenter","mouseleave"],r=0;r<i.length;r++)e(i[r])}function r(i){return e.reduce(i,e.bind((function(i,r,o){return i[o]=function(i){var r={_type:i.type,_value:i.value,get type(){return this._type},set type(e){t.Messaging.logError("Blotter.RenderScope",!1,"uniform types may not be updated through a text scope")},get value(){return this._value},set value(e){t.UniformUtils.validValueForUniformType(this._type,e)?(this._value=e,this.trigger("update")):t.Messaging.logError("Blotter.RenderScope",!1,"uniform value not valid for uniform type: "+this._type)}};return e.extend(r,n.prototype),r}(r),i[o].on("update",e.bind((function(){this.trigger("update:uniform",[o])}),this)),i}),this),{})}function o(){var n=this._mappingMaterial,i=n&&function(t,e){var n=t.boundsForText(e);if(n)return{w:n.w,h:n.h,x:-1*Math.floor(n.x),y:-1*Math.floor(t.height-(n.y+n.h))}}(n,this.text),o=this.material.uniforms;n&&i&&(t.CanvasUtils.updateCanvasSize(this.domElement,i.w/this.blotter.ratio,i.h/this.blotter.ratio,this.blotter.ratio),this.domElement.innerHTML=this.text.value,this.bounds=i,this.material.uniforms=r.call(this,n.uniforms),this.material.mainImage=n.mainImage,o&&function(t,n){e.each(t,(function(t,e){var i=n[e];if(i){var r=i.type==t.type,o=i.value==t.value;r&&!o&&(i.value=t.value)}}))}(o,this.material.uniforms),this.trigger(this.lastUpdated?"update":"ready"),this.lastUpdated=Date.now())}return{constructor:t.RenderScope,get needsUpdate(){},set needsUpdate(t){!0===t&&o.call(this)},get mappingMaterial(){},set mappingMaterial(t){this._mappingMaterial=t},play:function(){this.playing=!0},pause:function(){this.playing=!1},render:function(){if(this.bounds){var t=Date.now();this.frameCount+=1,this.timeDelta=(t-(this.lastDrawTime||t))/1e3,this.lastDrawTime=t,this.context.clearRect(0,0,this.domElement.width,this.domElement.height),this.context.putImageData(this.blotter.imageData,this.bounds.x,this.bounds.y),this.trigger("render",[this.frameCount])}},appendTo:function(t){return"function"==typeof t.append?t.append(this.domElement):t.appendChild(this.domElement),i.call(this),this}}}(),t._extendWithGettersSetters(t.RenderScope.prototype,n.prototype)}((void 0).Blotter,(void 0)._,(void 0).EventEmitter),function(t,e,n,i){var r=this;t.Renderer=function(){this._currentAnimationLoop=!1,this._scene=new n.Scene,this._plane=new n.PlaneGeometry(1,1),this._material=new n.MeshBasicMaterial,this._mesh=new n.Mesh(this._plane,this._material),this._scene.add(this._mesh),this._camera=new n.OrthographicCamera(.5,.5,.5,.5,0,100),this.init.apply(this,arguments)},t.Renderer.prototype=function(){function i(){t.webglRenderer.render(this._scene,this._camera,this._renderTarget),t.webglRenderer.readRenderTargetPixels(this._renderTarget,0,0,this._renderTarget.width,this._renderTarget.height,this._imageDataArray),this.trigger("render"),this._currentAnimationLoop=r.requestAnimationFrame(e.bind(i,this))}return{constructor:t.Renderer,get material(){},set material(t){t instanceof n.Material&&(this._material=t,this._mesh.material=t)},get width(){return this._width},set width(t){this.setSize(t,this._height)},get height(){return this._height},set height(t){this.setSize(this._width,t)},init:function(){this.setSize(1,1)},start:function(){this._currentAnimationLoop||i.call(this)},stop:function(){this._currentAnimationLoop&&(r.cancelAnimationFrame(this._currentAnimationLoop),this._currentAnimationLoop=void 0)},setSize:function(t,e){this._width=Math.trunc(t)||1,this._height=Math.trunc(e)||1,this._mesh.scale.set(this._width,this._height,1),this._camera.left=this._width/-2,this._camera.right=this._width/2,this._camera.top=this._height/2,this._camera.bottom=this._height/-2,this._camera.updateProjectionMatrix(),this._renderTarget=function(t,e){var i=new n.WebGLRenderTarget(t,e,{minFilter:n.LinearFilter,magFilter:n.LinearFilter,format:n.RGBAFormat,type:n.UnsignedByteType});return i.texture.generateMipmaps=!1,i.width=t,i.height=e,i}(this._width,this._height),this._viewBuffer=new ArrayBuffer(this._width*this._height*4),this._imageDataArray=new Uint8Array(this._viewBuffer),this._clampedImageDataArray=new Uint8ClampedArray(this._viewBuffer),this.imageData=new ImageData(this._clampedImageDataArray,this._width,this._height)},teardown:function(){this.stop()}}}(),t._extendWithGettersSetters(t.Renderer.prototype,i.prototype)}((void 0).Blotter,(void 0)._,(void 0).THREE,(void 0).EventEmitter),function(t,e,n,i){t.BoundsDataTextureBuilder={build:function(t,e){i((function(){var i=function(t){for(var e=t.texts,n=new Float32Array(4*e.length),i=0;i<e.length;i++){var r=e[i],o=t.boundsForText(r);n[4*i]=o.x,n[4*i+1]=t.height-(o.y+o.h),n[4*i+2]=o.w,n[4*i+3]=o.h}return n}(t),r=new n.DataTexture(i,t.texts.length,1,n.RGBAFormat,n.FloatType);r.needsUpdate=!0,e(r)}))}}}((void 0).Blotter,(void 0)._,(void 0).THREE,(void 0).setImmediate),function(t,e,n,i){t.IndicesDataTextureBuilder={build:function(t,e){i((function(){var i=t.width/t.ratio*.5,r=t.height/t.ratio*.5,o=function(t,e,n,i){for(var r=t.ratio,o=new Float32Array(n*e*4),a=e%1,s=1/t.texts.length/2,l=1;l<o.length/4;l++){for(var u=Math.ceil(l/(e-a)),c=l-(e-a)*(u-1),f=0,d=0,p=0;p<t.texts.length;p++){var h=t.texts[p],m=t.boundsForText(h),v=m.w/r*i,g=m.h/r*i,x=m.x/r*i,y=m.y/r*i;if(u>=y&&u<=y+g&&c>=x&&c<=x+v){f=p/t.texts.length+s,d=1;break}}var b=l-1;o[4*b+0]=f,o[4*b+1]=0,o[4*b+2]=0,o[4*b+3]=d}return o}(t,i,r,.5),a=new n.DataTexture(o,i,r,n.RGBAFormat,n.FloatType);a.flipY=!0,a.needsUpdate=!0,e(a)}))}}}((void 0).Blotter,(void 0)._,(void 0).THREE,(void 0).setImmediate),function(t,e,n){t.TextTextureBuilder={build:function(t,i){var r,o=new n.TextureLoader;t.toCanvas(e.bind((function(t){r=t.toDataURL(),o.load(r,e.bind((function(t){t.minFilter=n.LinearFilter,t.magFilter=n.LinearFilter,t.generateMipmaps=!0,t.needsUpdate=!0,i(t)}),this))}),this))}}}((void 0).Blotter,(void 0)._,(void 0).THREE),function(t,e,n,i,r){t.MappingBuilder=function(){function n(t,e){var n=t.w*t.h;return e.w*e.h-n}return{build:function(o,a){r((function(){var r,s=t.TextUtils.filterTexts(o),l=(r=s,e.reduce(r,(function(e,n){var i=t.TextUtils.sizeForText(n.value,n.properties);return e[n.id]=i,e}),[])),u=new i,c=[],f={};for(var d in l)if(l.hasOwnProperty(d)){var p=l[d];p.referenceId=d,c.push(p)}u.fit(c.sort(n));for(var h=0;h<c.length;h++){var m=c[h];f[m.referenceId]={w:m.w,h:m.h,x:m.fit.x,y:u.root.h-(m.fit.y+m.h)}}a(new t.Mapping(s,f,u.root.w,u.root.h))}))}}}()}((void 0).Blotter,(void 0)._,(void 0).THREE,(void 0).GrowingPacker,(void 0).setImmediate),function(t,e,n){t.MappingMaterialBuilder=function(){function i(t,n,i,r,o){var a={_uSampler:{type:"t",value:i},_uCanvasResolution:{type:"2f",value:[t,n]}};return e.extend(a,function(t){return e.reduce(t,(function(t,e){return t[e.uniformName]={type:"t",value:e.texture},t}),{})}(r)),e.extend(a,function(t){return{_userUniformsTexture:{type:"t",value:t.texture}}}(o)),a}return{build:function(r,o,a){var s,l,u,c;s=function(){return function(n){!function(n,i){var r,o,a=[];r=function(){return function(e){t.BoundsDataTextureBuilder.build(n,(function(t){a.push({uniformName:"_uTextBoundsTexture",texture:t}),e()}))}},o=[function(e){t.IndicesDataTextureBuilder.build(n,(function(t){a.push({uniformName:"_uTextIndicesTexture",texture:t}),e()}))},r()],e(o).reduceRight(e.wrap,(function(){i(a)}))()}(r,(function(t){u=t,n()}))}},buildUserUniformDataTextureObjects=function(){return function(i){!function(i,r,o){t.UniformUtils.ensureHasRequiredDefaultUniforms(i,"Blotter.MappingMaterialBuilder","_buildUserUniformDataTextureObjects"),i=t.UniformUtils.extractValidUniforms(i);var a=Object.keys(i).length*r,s=new Float32Array(4*a),l={data:s,texture:new n.DataTexture(s,a,1,n.RGBAFormat,n.FloatType),userUniforms:{}};e.reduce(i,(function(t,e,n){var o=Object.keys(i).indexOf(n)*r;return t.userUniforms[n]={userUniform:e,position:o},t}),l),o(l)}(o.uniforms,r.texts.length,(function(t){userUniformDataTextureObjects=t,i()}))}},c=[function(){return function(e){!function(e,n){t.TextTextureBuilder.build(e,(function(t){n(t)}))}(r,(function(t){l=t,e()}))}}(),s(),buildUserUniformDataTextureObjects()],e(c).reduceRight(e.wrap,(function(){var s,c,f,d,p=i(r.width,r.height,l,u,userUniformDataTextureObjects),h=(e.omit(p,"_uCanvasResolution","_uSampler","_uTextBoundsTexture","_uTextIndicesTexture"),s=["varying vec2 _vTexCoord;","void main() {","  _vTexCoord = uv;","  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","}"].join("\n"),c=function(n,i,r){var o={publicUniformDeclarations:"",publicUniformDefinitions:""},a=(1/n.data.length/2).toFixed(20),s=n.texture.image.width.toFixed(1);return e.reduce(n.userUniforms,(function(e,n,r){var o=t.UniformUtils.fullSwizzleStringForUniformType(n.userUniform.type),l=t.UniformUtils.glslDataTypeForUniformType(n.userUniform.type),u="(("+n.position.toFixed(1)+" + ((textIndex - ((1.0 / "+i.toFixed(1)+") / 2.0)) * "+i.toFixed(1)+")) / "+s+") + "+a;return e.publicUniformDeclarations+=l+" "+r+";\n",e.publicUniformDefinitions+="   "+r+" = texture2D(_userUniformsTexture, vec2("+u+", 0.5))."+o+";\n",e}),o),[t.Assets.Shaders.Blending,t.Assets.Shaders.TextTexture,"uniform sampler2D _uSampler;","uniform vec2 _uCanvasResolution;","uniform sampler2D _uTextIndicesTexture;","uniform sampler2D _uTextBoundsTexture;","varying vec2 _vTexCoord;","vec4 _textBounds;","uniform sampler2D _userUniformsTexture;",o.publicUniformDeclarations,"// Helper function used by user programs to retrieve texel color information within the bounds of","// any given text. This is to be used instead of `texture2D` in the fragment sources for all Blotter materials.","vec4 textTexture(vec2 coord) {","   vec2 adjustedFragCoord = _textBounds.xy + vec2((_textBounds.z * coord.x), (_textBounds.w * coord.y));","   vec2 uv = adjustedFragCoord.xy / _uCanvasResolution;","   //  If adjustedFragCoord falls outside the bounds of the current texel's text, return `vec4(0.0)`.","   if (adjustedFragCoord.x < _textBounds.x ||","       adjustedFragCoord.x > _textBounds.x + _textBounds.z ||","       adjustedFragCoord.y < _textBounds.y ||","       adjustedFragCoord.y > _textBounds.y + _textBounds.w) {","     return vec4(0.0);","   }","   return texture2D(_uSampler, uv);","}","void mainImage(out vec4 mainImage, in vec2 fragCoord);",r,"void main(void) {","   vec4 textIndexData = texture2D(_uTextIndicesTexture, _vTexCoord);","   float textIndex = textIndexData.r;","   float textAlpha = textIndexData.a;","   _textBounds = texture2D(_uTextBoundsTexture, vec2(textIndex, 0.5));",o.publicUniformDefinitions,"   uResolution = _textBounds.zw;","   vec2 fragCoord = gl_FragCoord.xy - _textBounds.xy;","   vec4 outColor;","   mainImage(outColor, fragCoord);","   outColor.a = outColor.a * textAlpha;","   gl_FragColor = outColor;","}"].join("\n")}(userUniformDataTextureObjects,r.texts.length,o.mainImage),f=p,(d=new n.ShaderMaterial({vertexShader:s,fragmentShader:c,uniforms:f})).depthTest=!1,d.depthWrite=!1,d.premultipliedAlpha=!1,d);a(new t.MappingMaterial(r,o,h,userUniformDataTextureObjects))}))()}}}()}((void 0).Blotter,(void 0)._,(void 0).THREE),(nt=(void 0).Blotter).FliesMaterial=function(){nt.Material.apply(this,arguments)},nt.FliesMaterial.prototype=Object.create(nt.Material.prototype),nt._extendWithGettersSetters(nt.FliesMaterial.prototype,{constructor:nt.FliesMaterial,init:function(){this.mainImage=[nt.Assets.Shaders.Random,"vec2 random2(vec2 p) {","    return fract(sin(vec2(dot(p, vec2(127.1, 311.7)), dot(p, vec2(269.5, 183.3)))) * 43758.5453);","}","float isParticle(out vec3 particleColor, vec2 fragCoord, float pointRadius, float pointCellWidth, float dodge, vec2 dodgePosition, float dodgeSpread, float speed) {    ","    if (pointCellWidth == 0.0) { return 0.0; };","    vec2 uv = fragCoord.xy / uResolution.xy;","    float pointRadiusOfCell = pointRadius / pointCellWidth;","    vec2 totalCellCount = uResolution.xy / pointCellWidth;","    vec2 cellUv = uv * totalCellCount;","    // Tile the space","    vec2 iUv = floor(cellUv);","    vec2 fUv = fract(cellUv);","    float minDist = 1.0;  // minimun distance","    vec4 baseSample = textTexture(cellUv);","    float maxWeight = 0.0;","    particleColor = baseSample.rgb;","    for (int y= -1; y <= 1; y++) {","        for (int x= -1; x <= 1; x++) {","            // Neighbor place in the grid","            vec2 neighbor = vec2(float(x), float(y));","            // Random position from current + neighbor place in the grid","            vec2 point = random2(iUv + neighbor);","            // Get cell weighting from cell's center alpha","            vec2 cellRowCol = floor(fragCoord / pointCellWidth) + neighbor;","            vec2 cellFragCoord = ((cellRowCol * pointCellWidth) + (pointCellWidth / 2.0));","            vec4 cellSample = textTexture(cellFragCoord / uResolution.xy);","            float cellWeight = cellSample.a;","            if (cellWeight < 1.0) {","               // If the cell is not fully within our text, we should disregard it","               continue;","            }","            maxWeight = max(maxWeight, cellWeight);","            if (cellWeight == maxWeight) {","                particleColor = cellSample.rgb;","            }","            float distanceFromDodge = distance(dodgePosition * uResolution.xy, cellFragCoord) / uResolution.y;","            distanceFromDodge = 1.0 - smoothstep(0.0, dodgeSpread, distanceFromDodge);","            // Apply weighting to noise and dodge if dodge is set to 1.0","            cellWeight = step(cellWeight, random(cellRowCol)) + (distanceFromDodge * dodge);","            // Animate the point","            point = 0.5 + 0.75 * sin((uGlobalTime * speed) + 6.2831 * point);","            // Vector between the pixel and the point","            vec2 diff = neighbor + point - fUv;","            // Distance to the point","            float dist = length(diff);","            dist += cellWeight; // Effectively remove point","            // Keep the closer distance","            minDist = min(minDist, dist);","        }","    }","    float pointEasing = pointRadiusOfCell - (1.0 / pointCellWidth);","    float isParticle = 1.0 - smoothstep(pointEasing, pointRadiusOfCell, minDist);","    return isParticle;","}","void mainImage( out vec4 mainImage, in vec2 fragCoord ) {","    vec2 uv = fragCoord.xy / uResolution.xy;","    // Convert uPointCellWidth to pixels, keeping it between 1 and the total y resolution of the text","    // Note: floor uPointCellWidth here so that we dont have half pixel widths on retina displays","    float pointCellWidth = floor(max(0.0, min(1.0, uPointCellWidth) * uResolution.y));","    // Ensure uPointRadius allow points to exceed the width of their cells","    float pointRadius = uPointRadius * 0.8;","    pointRadius = min(pointRadius * pointCellWidth, pointCellWidth);","    float dodge = ceil(uDodge);","    vec3 outColor = vec3(0.0);","    float point = isParticle(outColor, fragCoord, pointRadius, pointCellWidth, dodge, uDodgePosition, uDodgeSpread, uSpeed);","    mainImage = vec4(outColor, point);","}"].join("\n"),this.uniforms={uPointCellWidth:{type:"1f",value:.04},uPointRadius:{type:"1f",value:.75},uDodge:{type:"1f",value:0},uDodgePosition:{type:"2f",value:[.5,.5]},uDodgeSpread:{type:"1f",value:.25},uSpeed:{type:"1f",value:1}}}});var rt=new Blotter.Text("The Hidden Gatsbies",{family:"serif",size:100,fill:"white",paddingLeft:300}),ot=new Blotter.FliesMaterial;ot.uniforms.uPointCellWidth.value=.017,ot.uniforms.uPointRadius.value=.8,ot.uniforms.uSpeed.value=5;var at=new Blotter(ot,{texts:rt});at.needsUpdate=!0;var st=document.getElementById("title-text");at.forText(rt).appendTo(st),window.addEventListener("scroll",(t=>{(void 0).scrollY,(void 0).scrollY>200?st.style.opacity=0:st.style.opacity=1-(void 0).scrollY/200}));
